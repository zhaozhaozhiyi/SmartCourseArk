{"version":3,"file":"index.js","sources":["../src/CanvasRendererPlugin.ts","../src/shapes/styles/helper.ts","../src/shapes/styles/OptimizedDefault.ts","../src/shapes/styles/Default.ts","../src/utils/math.ts","../src/shapes/styles/Image.ts","../src/shapes/styles/Text.ts","../src/index.ts"],"sourcesContent":["import type {\n  DisplayObject,\n  FederatedEvent,\n  RBushNodeAABB,\n  RenderingPlugin,\n  RBush,\n  RenderingPluginContext,\n  ContextService,\n  CanvasContext,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  CSSRGB,\n} from '@antv/g-lite';\nimport {\n  AABB,\n  CanvasEvent,\n  CustomEvent,\n  ElementEvent,\n  Shape,\n  Node,\n} from '@antv/g-lite';\nimport { mat4, vec3 } from 'gl-matrix';\nimport { isNil } from '@antv/util';\nimport type { CanvasRendererPluginOptions } from './interfaces';\nimport type { Plugin } from '.';\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface RenderState {\n  restoreStack: DisplayObject[];\n  prevObject: DisplayObject;\n  currentContext: Map<keyof CanvasRenderingContext2D | 'lineDash', unknown>;\n}\n\n/**\n * support 2 modes in rendering:\n * * immediate\n * * delayed: render at the end of frame with dirty-rectangle\n */\nexport class CanvasRendererPlugin implements RenderingPlugin {\n  static tag = 'CanvasRenderer';\n\n  private context: Plugin['context'];\n\n  private pathGeneratorFactory: Plugin['context']['pathGeneratorFactory'];\n\n  /**\n   * RBush used in dirty rectangle rendering\n   */\n  private rBush: RBush<RBushNodeAABB>;\n\n  constructor(\n    private canvasRendererPluginOptions: CanvasRendererPluginOptions, // private styleRendererFactory: Record<Shape, StyleRenderer>,\n  ) {}\n\n  private removedRBushNodeAABBs: RBushNodeAABB[] = [];\n\n  private renderQueue: DisplayObject[] = [];\n\n  #renderState: RenderState = {\n    restoreStack: [],\n    prevObject: null,\n    currentContext: new Map(),\n  };\n\n  private clearFullScreenLastFrame = false;\n  private clearFullScreen = false;\n\n  /**\n   * view projection matrix\n   */\n  private vpMatrix = mat4.create();\n  private dprMatrix = mat4.create();\n  private tmpMat4 = mat4.create();\n  private vec3a = vec3.create();\n  private vec3b = vec3.create();\n  private vec3c = vec3.create();\n  private vec3d = vec3.create();\n\n  apply(context: RenderingPluginContext, runtime: GlobalRuntime) {\n    this.context = context as unknown as Plugin['context'];\n\n    const {\n      config,\n      camera,\n      renderingService,\n      renderingContext,\n      rBushRoot,\n      // @ts-ignore\n      pathGeneratorFactory,\n    } = this.context;\n    let enableRenderingOptimization =\n      config.renderer.getConfig().enableRenderingOptimization;\n\n    config.renderer.getConfig().enableDirtyCheck = false;\n    config.renderer.getConfig().enableDirtyRectangleRendering = false;\n\n    this.rBush = rBushRoot;\n    this.pathGeneratorFactory = pathGeneratorFactory;\n\n    const contextService =\n      context.contextService as ContextService<CanvasRenderingContext2D>;\n\n    const canvas = renderingContext.root.ownerDocument.defaultView;\n\n    const handleUnmounted = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n\n      // remove r-bush node\n      // @ts-ignore\n      const { rBushNode } = object;\n\n      if (rBushNode?.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n\n    const handleCulled = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n      // @ts-ignore\n      const { rBushNode } = object;\n\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n\n    renderingService.hooks.init.tap(CanvasRendererPlugin.tag, () => {\n      canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.addEventListener(ElementEvent.CULLED, handleCulled);\n\n      // clear fullscreen\n      const dpr = contextService.getDPR();\n      const { width, height } = config;\n      const context = contextService.getContext();\n      this.clearRect(\n        context,\n        0,\n        0,\n        width * dpr,\n        height * dpr,\n        config.background,\n      );\n    });\n\n    renderingService.hooks.destroy.tap(CanvasRendererPlugin.tag, () => {\n      canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.removeEventListener(ElementEvent.CULLED, handleCulled);\n      this.renderQueue = [];\n      this.removedRBushNodeAABBs = [];\n      this.#renderState = {\n        restoreStack: [],\n        prevObject: null,\n        currentContext: null,\n      };\n    });\n\n    const beforeDraw = () => {\n      const context = contextService.getContext();\n      const dpr = contextService.getDPR();\n      const { width, height } = config;\n      const { dirtyObjectNumThreshold, dirtyObjectRatioThreshold } =\n        this.canvasRendererPluginOptions;\n\n      // some heuristic conditions such as 80% object changed\n      const { total, rendered } = renderingService.getStats();\n      const ratio = rendered / total;\n\n      this.clearFullScreen =\n        this.clearFullScreenLastFrame ||\n        // @ts-ignore\n        !canvas.context.renderingPlugins[1]?.isFirstTimeRenderingFinished ||\n        renderingService.disableDirtyRectangleRendering() ||\n        (rendered > dirtyObjectNumThreshold &&\n          ratio > dirtyObjectRatioThreshold);\n\n      if (!context) {\n        return;\n      }\n\n      if (typeof context.resetTransform === 'function') {\n        context.resetTransform();\n      } else {\n        context.setTransform(1, 0, 0, 1, 0, 0);\n      }\n\n      if (this.clearFullScreen) {\n        this.clearRect(\n          context,\n          0,\n          0,\n          width * dpr,\n          height * dpr,\n          config.background,\n        );\n      }\n    };\n\n    /**\n     * render objects by z-index\n     *\n     * - The level of the child node will be affected by the level of the parent node\n     */\n    const renderByZIndex = (\n      object: DisplayObject,\n      context: CanvasRenderingContext2D,\n    ) => {\n      const stack = [object];\n\n      while (stack.length > 0) {\n        const currentObject = stack.pop();\n\n        if (currentObject.isVisible() && !currentObject.isCulled()) {\n          if (enableRenderingOptimization) {\n            this.renderDisplayObjectOptimized(\n              currentObject,\n              context,\n              this.context,\n              this.#renderState,\n              runtime,\n            );\n          } else {\n            this.renderDisplayObject(\n              currentObject,\n              context,\n              this.context,\n              this.#renderState,\n              runtime,\n            );\n          }\n        }\n\n        const objects =\n          currentObject.sortable?.sorted?.length > 0\n            ? currentObject.sortable.sorted\n            : currentObject.childNodes;\n        // should account for z-index\n        for (let i = objects.length - 1; i >= 0; i--) {\n          stack.push(objects[i] as unknown as DisplayObject);\n        }\n      }\n    };\n\n    // render at the end of frame\n    renderingService.hooks.endFrame.tap(CanvasRendererPlugin.tag, () => {\n      beforeDraw();\n\n      // Skip rendering.\n      if (renderingContext.root.childNodes.length === 0) {\n        this.clearFullScreenLastFrame = true;\n        return;\n      }\n\n      enableRenderingOptimization =\n        config.renderer.getConfig().enableRenderingOptimization;\n\n      // init\n      this.#renderState = {\n        restoreStack: [],\n        prevObject: null,\n        currentContext: this.#renderState.currentContext,\n      };\n      this.#renderState.currentContext.clear();\n      this.clearFullScreenLastFrame = false;\n\n      const context = contextService.getContext();\n      // clear & clip dirty rectangle\n      const dpr = contextService.getDPR();\n      mat4.fromScaling(this.dprMatrix, [dpr, dpr, 1]);\n      mat4.multiply(this.vpMatrix, this.dprMatrix, camera.getOrthoMatrix());\n\n      if (this.clearFullScreen) {\n        // console.time('renderByZIndex');\n        if (enableRenderingOptimization) {\n          context.save();\n          renderByZIndex(renderingContext.root, context);\n          context.restore();\n        } else {\n          renderByZIndex(renderingContext.root, context);\n        }\n        // console.timeEnd('renderByZIndex');\n\n        this.removedRBushNodeAABBs = [];\n      } else {\n        // console.log('canvas renderer next...', this.renderQueue);\n        // merge removed AABB\n        const dirtyRenderBounds = this.safeMergeAABB(\n          this.mergeDirtyAABBs(this.renderQueue),\n          ...this.removedRBushNodeAABBs.map(({ minX, minY, maxX, maxY }) => {\n            const aabb = new AABB();\n            aabb.setMinMax(\n              // vec3.fromValues(minX, minY, 0),\n              // vec3.fromValues(maxX, maxY, 0),\n              [minX, minY, 0],\n              [maxX, maxY, 0],\n            );\n            return aabb;\n          }),\n        );\n        this.removedRBushNodeAABBs = [];\n\n        if (AABB.isEmpty(dirtyRenderBounds)) {\n          this.renderQueue = [];\n          return;\n        }\n\n        const dirtyRect = this.convertAABB2Rect(dirtyRenderBounds);\n        const { x, y, width, height } = dirtyRect;\n\n        const tl = vec3.transformMat4(this.vec3a, [x, y, 0], this.vpMatrix);\n        const tr = vec3.transformMat4(\n          this.vec3b,\n          [x + width, y, 0],\n          this.vpMatrix,\n        );\n        const bl = vec3.transformMat4(\n          this.vec3c,\n          [x, y + height, 0],\n          this.vpMatrix,\n        );\n        const br = vec3.transformMat4(\n          this.vec3d,\n          [x + width, y + height, 0],\n          this.vpMatrix,\n        );\n\n        const minx = Math.min(tl[0], tr[0], br[0], bl[0]);\n        const miny = Math.min(tl[1], tr[1], br[1], bl[1]);\n        const maxx = Math.max(tl[0], tr[0], br[0], bl[0]);\n        const maxy = Math.max(tl[1], tr[1], br[1], bl[1]);\n\n        const ix = Math.floor(minx);\n        const iy = Math.floor(miny);\n        const iwidth = Math.ceil(maxx - minx);\n        const iheight = Math.ceil(maxy - miny);\n\n        context.save();\n        this.clearRect(context, ix, iy, iwidth, iheight, config.background);\n        context.beginPath();\n        context.rect(ix, iy, iwidth, iheight);\n        context.clip();\n\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n        context.setTransform(\n          this.vpMatrix[0],\n          this.vpMatrix[1],\n          this.vpMatrix[4],\n          this.vpMatrix[5],\n          this.vpMatrix[12],\n          this.vpMatrix[13],\n        );\n\n        // draw dirty rectangle\n        const { enableDirtyRectangleRenderingDebug } =\n          config.renderer.getConfig();\n        if (enableDirtyRectangleRenderingDebug) {\n          canvas.dispatchEvent(\n            new CustomEvent(CanvasEvent.DIRTY_RECTANGLE, {\n              dirtyRect: {\n                x: ix,\n                y: iy,\n                width: iwidth,\n                height: iheight,\n              },\n            }),\n          );\n        }\n\n        // search objects intersect with dirty rectangle\n        const dirtyObjects = this.searchDirtyObjects(dirtyRenderBounds);\n\n        // do rendering\n        dirtyObjects\n          // sort by z-index\n          .sort((a, b) => a.sortable.renderOrder - b.sortable.renderOrder)\n          .forEach((object) => {\n            // culled object should not be rendered\n            if (object && object.isVisible() && !object.isCulled()) {\n              this.renderDisplayObject(\n                object,\n                context,\n                this.context,\n                this.#renderState,\n                runtime,\n              );\n            }\n          });\n\n        context.restore();\n\n        // save dirty AABBs in last frame\n        this.renderQueue.forEach((object) => {\n          this.saveDirtyAABB(object);\n        });\n\n        // clear queue\n        this.renderQueue = [];\n      }\n\n      // pop restore stack, eg. root -> parent -> child\n      this.#renderState.restoreStack.forEach(() => {\n        context.restore();\n      });\n      // clear restore stack\n      this.#renderState.restoreStack = [];\n    });\n\n    renderingService.hooks.render.tap(\n      CanvasRendererPlugin.tag,\n      (object: DisplayObject) => {\n        if (!this.clearFullScreen) {\n          // render at the end of frame\n          this.renderQueue.push(object);\n        }\n      },\n    );\n  }\n\n  private clearRect(\n    context: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    background: string,\n  ) {\n    // clearRect is faster than fillRect @see https://stackoverflow.com/a/30830253\n    context.clearRect(x, y, width, height);\n    if (background) {\n      context.fillStyle = background;\n      context.fillRect(x, y, width, height);\n    }\n  }\n\n  renderDisplayObjectOptimized(\n    object: DisplayObject,\n    context: CanvasRenderingContext2D,\n    canvasContext: CanvasContext,\n    renderState: RenderState,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n    let updateTransform = false;\n    let clipDraw = false;\n\n    // @ts-ignore\n    const styleRenderer = this.context.styleRendererFactory[nodeName];\n    const generatePath = this.pathGeneratorFactory[nodeName];\n\n    // clip path\n    const { clipPath } = object.parsedStyle;\n    if (clipPath) {\n      updateTransform =\n        !renderState.prevObject ||\n        !mat4.exactEquals(\n          clipPath.getWorldTransform(),\n          renderState.prevObject.getWorldTransform(),\n        );\n\n      if (updateTransform) {\n        this.applyWorldTransform(context, clipPath);\n        renderState.prevObject = null;\n      }\n\n      // generate path in local space\n      const generatePath =\n        this.pathGeneratorFactory[clipPath.nodeName as Shape];\n      if (generatePath) {\n        context.save();\n        clipDraw = true;\n\n        context.beginPath();\n        generatePath(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n\n    // fill & stroke\n\n    if (styleRenderer) {\n      updateTransform =\n        !renderState.prevObject ||\n        !mat4.exactEquals(\n          object.getWorldTransform(),\n          renderState.prevObject.getWorldTransform(),\n        );\n\n      if (updateTransform) {\n        this.applyWorldTransform(context, object);\n      }\n\n      let forceUpdateStyle = !renderState.prevObject;\n      if (!forceUpdateStyle) {\n        const prevNodeName = renderState.prevObject.nodeName as Shape;\n\n        if (nodeName === Shape.TEXT) {\n          forceUpdateStyle = prevNodeName !== Shape.TEXT;\n        } else if (nodeName === Shape.IMAGE) {\n          forceUpdateStyle = prevNodeName !== Shape.IMAGE;\n        } else {\n          forceUpdateStyle =\n            prevNodeName === Shape.TEXT || prevNodeName === Shape.IMAGE;\n        }\n      }\n\n      styleRenderer.applyStyleToContext(\n        context,\n        object,\n        forceUpdateStyle,\n        renderState,\n      );\n\n      renderState.prevObject = object;\n    }\n\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (\n        nodeName !== Shape.LINE &&\n        nodeName !== Shape.PATH &&\n        nodeName !== Shape.POLYLINE\n      ) {\n        context.closePath();\n      }\n    }\n\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.drawToContext(\n        context,\n        object,\n        this.#renderState,\n        this,\n        runtime,\n      );\n    }\n\n    if (clipDraw) {\n      context.restore();\n    }\n\n    // finish rendering, clear dirty flag\n    object.dirty(false);\n  }\n\n  renderDisplayObject(\n    object: DisplayObject,\n    context: CanvasRenderingContext2D,\n    canvasContext: CanvasContext,\n    renderState: RenderState,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n\n    // restore to its ancestor\n\n    const parent =\n      renderState.restoreStack[renderState.restoreStack.length - 1];\n    if (\n      parent &&\n      !(\n        object.compareDocumentPosition(parent) & Node.DOCUMENT_POSITION_CONTAINS\n      )\n    ) {\n      context.restore();\n      renderState.restoreStack.pop();\n    }\n\n    // @ts-ignore\n    const styleRenderer = this.context.styleRendererFactory[nodeName];\n    const generatePath = this.pathGeneratorFactory[nodeName];\n\n    // clip path\n    const { clipPath } = object.parsedStyle;\n    if (clipPath) {\n      this.applyWorldTransform(context, clipPath);\n\n      // generate path in local space\n      const generatePath =\n        this.pathGeneratorFactory[clipPath.nodeName as Shape];\n      if (generatePath) {\n        context.save();\n\n        // save clip\n        renderState.restoreStack.push(object);\n\n        context.beginPath();\n        generatePath(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n\n    // fill & stroke\n\n    if (styleRenderer) {\n      this.applyWorldTransform(context, object);\n\n      context.save();\n\n      // apply attributes to context\n      this.applyAttributesToContext(context, object);\n    }\n\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (\n        nodeName !== Shape.LINE &&\n        nodeName !== Shape.PATH &&\n        nodeName !== Shape.POLYLINE\n      ) {\n        context.closePath();\n      }\n    }\n\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.render(\n        context,\n        object.parsedStyle,\n        object,\n        canvasContext,\n        this,\n        runtime,\n      );\n\n      // restore applied attributes, eg. shadowBlur shadowColor...\n      context.restore();\n    }\n\n    // finish rendering, clear dirty flag\n    object.dirty(false);\n  }\n\n  private applyAttributesToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n  ) {\n    const { stroke, fill, opacity, lineDash, lineDashOffset } =\n      object.parsedStyle as ParsedBaseStyleProps;\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setLineDash\n    if (lineDash) {\n      context.setLineDash(lineDash);\n    }\n\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset\n    if (!isNil(lineDashOffset)) {\n      context.lineDashOffset = lineDashOffset;\n    }\n\n    if (!isNil(opacity)) {\n      context.globalAlpha *= opacity;\n    }\n\n    if (\n      !isNil(stroke) &&\n      !Array.isArray(stroke) &&\n      !(stroke as CSSRGB).isNone\n    ) {\n      context.strokeStyle = object.attributes.stroke as string;\n    }\n\n    if (!isNil(fill) && !Array.isArray(fill) && !(fill as CSSRGB).isNone) {\n      context.fillStyle = object.attributes.fill as string;\n    }\n  }\n\n  private convertAABB2Rect(aabb: AABB): Rect {\n    const min = aabb.getMin();\n    const max = aabb.getMax();\n    // expand the rectangle a bit to avoid artifacts\n    // @see https://www.yuque.com/antv/ou292n/bi8nix#ExvCu\n    const minX = Math.floor(min[0]);\n    const minY = Math.floor(min[1]);\n    const maxX = Math.ceil(max[0]);\n    const maxY = Math.ceil(max[1]);\n    const width = maxX - minX;\n    const height = maxY - minY;\n\n    return { x: minX, y: minY, width, height };\n  }\n\n  /**\n   * TODO: merge dirty rectangles with some strategies.\n   * For now, we just simply merge all the rectangles into one.\n   * @see https://idom.me/articles/841.html\n   */\n  private mergeDirtyAABBs(dirtyObjects: DisplayObject[]): AABB {\n    // merge into a big AABB\n    // TODO: skip descendant if ancestor is caculated, but compareNodePosition is really slow\n    const aabb = new AABB();\n    dirtyObjects.forEach((object) => {\n      const renderBounds = object.getRenderBounds();\n      aabb.add(renderBounds);\n\n      const { dirtyRenderBounds } = object.renderable;\n      if (dirtyRenderBounds) {\n        aabb.add(dirtyRenderBounds);\n      }\n    });\n\n    return aabb;\n  }\n\n  private searchDirtyObjects(dirtyRectangle: AABB): DisplayObject[] {\n    // search in r-tree, get all affected nodes\n    const [minX, minY] = dirtyRectangle.getMin();\n    const [maxX, maxY] = dirtyRectangle.getMax();\n    const rBushNodes = this.rBush.search({\n      minX,\n      minY,\n      maxX,\n      maxY,\n    });\n\n    return rBushNodes.map(({ displayObject }) => displayObject);\n  }\n\n  private saveDirtyAABB(object: DisplayObject) {\n    const { renderable } = object;\n    if (!renderable.dirtyRenderBounds) {\n      renderable.dirtyRenderBounds = new AABB();\n    }\n    const renderBounds = object.getRenderBounds();\n    if (renderBounds) {\n      // save last dirty aabb\n      renderable.dirtyRenderBounds.update(\n        renderBounds.center,\n        renderBounds.halfExtents,\n      );\n    }\n  }\n\n  private applyWorldTransform(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    matrix?: mat4,\n  ) {\n    // apply clip shape's RTS\n    if (matrix) {\n      mat4.copy(this.tmpMat4, object.getLocalTransform());\n      mat4.multiply(this.tmpMat4, matrix, this.tmpMat4);\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    } else {\n      // apply RTS transformation in world space\n      mat4.copy(this.tmpMat4, object.getWorldTransform());\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    }\n\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n    context.setTransform(\n      this.tmpMat4[0],\n      this.tmpMat4[1],\n      this.tmpMat4[4],\n      this.tmpMat4[5],\n      this.tmpMat4[12],\n      this.tmpMat4[13],\n    );\n  }\n\n  private safeMergeAABB(...aabbs: AABB[]): AABB {\n    const merged = new AABB();\n    aabbs.forEach((aabb) => {\n      merged.add(aabb);\n    });\n    return merged;\n  }\n}\n","import {\n  CanvasContext,\n  CSSGradientValue,\n  DisplayObject,\n  GlobalRuntime,\n  LinearGradient,\n  Pattern,\n  RadialGradient,\n  Rect,\n  GradientType,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport function getPattern(\n  pattern: Pattern,\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n): CanvasPattern {\n  let $offscreenCanvas: HTMLCanvasElement;\n  let dpr: number;\n  if ((pattern.image as Rect).nodeName === 'rect') {\n    const { width, height } = (pattern.image as Rect).parsedStyle;\n    dpr = canvasContext.contextService.getDPR();\n    const { offscreenCanvas } = canvasContext.config;\n    $offscreenCanvas = runtime.offscreenCanvasCreator.getOrCreateCanvas(\n      offscreenCanvas,\n    ) as HTMLCanvasElement;\n\n    $offscreenCanvas.width = width * dpr;\n    $offscreenCanvas.height = height * dpr;\n\n    const offscreenCanvasContext =\n      runtime.offscreenCanvasCreator.getOrCreateContext(\n        offscreenCanvas,\n      ) as CanvasRenderingContext2D;\n\n    const renderState: RenderState = {\n      restoreStack: [],\n      prevObject: null,\n      currentContext: new Map(),\n    };\n\n    // offscreenCanvasContext.scale(1 / dpr, 1 / dpr);\n\n    (pattern.image as Rect).forEach((object: DisplayObject) => {\n      plugin.renderDisplayObject(\n        object,\n        offscreenCanvasContext,\n        canvasContext,\n        renderState,\n        runtime,\n      );\n    });\n\n    renderState.restoreStack.forEach(() => {\n      offscreenCanvasContext.restore();\n    });\n  }\n\n  const canvasPattern = imagePool.getOrCreatePatternSync(\n    object,\n    pattern,\n    context,\n    $offscreenCanvas,\n    dpr,\n    object.getGeometryBounds().min,\n    () => {\n      // set dirty rectangle flag\n      object.dirty();\n      canvasContext.renderingService.dirtify();\n    },\n  );\n\n  return canvasPattern;\n}\n\nexport function getColor(\n  parsedColor: CSSGradientValue,\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  imagePool: ImagePool,\n) {\n  let color: CanvasGradient | string;\n\n  if (\n    parsedColor.type === GradientType.LinearGradient ||\n    parsedColor.type === GradientType.RadialGradient\n  ) {\n    const bounds = object.getGeometryBounds();\n    const width = (bounds && bounds.halfExtents[0] * 2) || 1;\n    const height = (bounds && bounds.halfExtents[1] * 2) || 1;\n    const min = (bounds && bounds.min) || [0, 0];\n    color = imagePool.getOrCreateGradient(\n      {\n        type: parsedColor.type,\n        ...(parsedColor.value as LinearGradient & RadialGradient),\n        min: min as [number, number],\n        width,\n        height,\n      },\n      context,\n    );\n  }\n\n  return color;\n}\n","import {\n  CanvasContext,\n  CSSRGB,\n  DisplayObject,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  isPattern,\n  Shape,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\nimport type { StyleRenderer } from './interfaces';\nimport { getColor, getPattern } from './helper';\n\nconst SHADOW_NUMBER_STYLE = [\n  'shadowBlur',\n  'shadowOffsetX',\n  'shadowOffsetY',\n] as const;\nconst STROKE_STYLE = ['lineCap', 'lineJoin', 'miterLimit'] as const;\nexport const DEFAULT_STYLE = {\n  // common\n  globalAlpha: 1,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0,\n  shadowColor: '#000',\n  filter: 'none' as const,\n  globalCompositeOperation: 'source-over' as const,\n\n  // stroke/fill\n  strokeStyle: '#000',\n  strokeOpacity: 1,\n  lineWidth: 1,\n  lineDash: [],\n  lineDashOffset: 0,\n  lineCap: 'butt' as const,\n  lineJoin: 'miter' as const,\n  miterLimit: 10,\n  fillStyle: '#000',\n  fillOpacity: 1,\n\n  // image\n};\n\nconst defaultParsedStyle = {} as ParsedBaseStyleProps;\n\n/**\n * Updating the canvas context is an expensive operation. The state of the context is cached and the actual update operation is performed only when the cache is not hit.\n *\n * In any case, the previous value is returned, which is convenient for temporarily updating the context and restoring it later.\n */\nfunction updateContextIfNotHitCache<\n  K extends keyof CanvasRenderingContext2D | 'lineDash',\n  V = unknown,\n>(context: CanvasRenderingContext2D, key: K, value: V, cache: Map<K, unknown>) {\n  const prevValue = (\n    cache.has(key)\n      ? cache.get(key)\n      : DEFAULT_STYLE[key as keyof typeof DEFAULT_STYLE]\n  ) as V;\n\n  if (prevValue !== value) {\n    // console.log('not hit cache', key, value, prevValue, cache);\n    if (key === 'lineDash') {\n      context.setLineDash(value as number[]);\n    } else {\n      // @ts-ignore\n      context[key] = value;\n    }\n    cache.set(key, value);\n  }\n\n  return prevValue;\n}\n\nexport class OptimizedDefaultRenderer implements StyleRenderer {\n  constructor(public imagePool: ImagePool) {}\n\n  applyAttributesToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n  ) {}\n\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedBaseStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {}\n\n  // #region common style\n  private applyCommonStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    // const dpr = object.ownerDocument.defaultView.getContextService().getDPR();\n    const prevStyle = forceUpdate\n      ? defaultParsedStyle\n      : renderState.prevObject.parsedStyle;\n    const style = object.parsedStyle;\n\n    if (forceUpdate || style.opacity !== prevStyle.opacity) {\n      updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        !isNil(style.opacity) ? style.opacity : DEFAULT_STYLE.globalAlpha,\n        renderState.currentContext,\n      );\n    }\n\n    // TODO blend prop\n    // @ts-ignore\n    if (forceUpdate || style.blend !== prevStyle.blend) {\n      updateContextIfNotHitCache(\n        context,\n        'globalCompositeOperation',\n        // @ts-ignore\n        !isNil(style.blend)\n          ? // @ts-ignore\n            style.blend\n          : DEFAULT_STYLE.globalCompositeOperation,\n        renderState.currentContext,\n      );\n    }\n  }\n  // #endregion common style\n\n  // #region stroke/fill style\n  private applyStrokeFillStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    const prevStyle = forceUpdate\n      ? defaultParsedStyle\n      : renderState.prevObject.parsedStyle;\n    const style = object.parsedStyle;\n    const { lineWidth = DEFAULT_STYLE.lineWidth } = style;\n    const hasFill = style.fill && !(style.fill as CSSRGB).isNone;\n    const hasStroke =\n      style.stroke && !(style.stroke as CSSRGB).isNone && lineWidth > 0;\n\n    if (hasStroke) {\n      if (\n        forceUpdate ||\n        object.attributes.stroke !== renderState.prevObject.attributes.stroke\n      ) {\n        const value =\n          !isNil(style.stroke) &&\n          !Array.isArray(style.stroke) &&\n          !(style.stroke as CSSRGB).isNone\n            ? object.attributes.stroke\n            : DEFAULT_STYLE.strokeStyle;\n\n        updateContextIfNotHitCache(\n          context,\n          'strokeStyle',\n          value,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineWidth !== prevStyle.lineWidth) {\n        updateContextIfNotHitCache(\n          context,\n          'lineWidth',\n          !isNil(style.lineWidth) ? style.lineWidth : DEFAULT_STYLE.lineWidth,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineDash !== prevStyle.lineDash) {\n        updateContextIfNotHitCache(\n          context,\n          'lineDash',\n          style.lineDash || DEFAULT_STYLE.lineDash,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineDashOffset !== prevStyle.lineDashOffset) {\n        updateContextIfNotHitCache(\n          context,\n          'lineDashOffset',\n          !isNil(style.lineDashOffset)\n            ? style.lineDashOffset\n            : DEFAULT_STYLE.lineDashOffset,\n          renderState.currentContext,\n        );\n      }\n\n      for (let i = 0; i < STROKE_STYLE.length; i++) {\n        const styleName = STROKE_STYLE[i];\n        if (forceUpdate || style[styleName] !== prevStyle[styleName]) {\n          updateContextIfNotHitCache(\n            context,\n            styleName,\n            !isNil(style[styleName])\n              ? style[styleName]\n              : DEFAULT_STYLE[styleName],\n            renderState.currentContext,\n          );\n        }\n      }\n    }\n\n    if (\n      hasFill &&\n      (forceUpdate ||\n        object.attributes.fill !== renderState.prevObject.attributes.fill)\n    ) {\n      const value =\n        !isNil(style.fill) &&\n        !Array.isArray(style.fill) &&\n        !(style.fill as CSSRGB).isNone\n          ? object.attributes.fill\n          : DEFAULT_STYLE.fillStyle;\n\n      updateContextIfNotHitCache(\n        context,\n        'fillStyle',\n        value,\n        renderState.currentContext,\n      );\n    }\n  }\n  // #endregion stroke/fill style\n\n  applyStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    const nodeName = object.nodeName as Shape;\n\n    this.applyCommonStyleToContext(context, object, forceUpdate, renderState);\n\n    if (nodeName === Shape.IMAGE) {\n      //\n    } else {\n      this.applyStrokeFillStyleToContext(\n        context,\n        object,\n        forceUpdate,\n        renderState,\n      );\n    }\n  }\n\n  applyShadowAndFilterStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    hasShadow: boolean,\n    renderState: RenderState,\n  ) {\n    const style = object.parsedStyle;\n\n    if (hasShadow) {\n      updateContextIfNotHitCache(\n        context,\n        'shadowColor',\n        style.shadowColor.toString(),\n        renderState.currentContext,\n      );\n      for (let i = 0; i < SHADOW_NUMBER_STYLE.length; i++) {\n        const styleName = SHADOW_NUMBER_STYLE[i];\n        updateContextIfNotHitCache(\n          context,\n          styleName,\n          style[styleName] || DEFAULT_STYLE[styleName],\n          renderState.currentContext,\n        );\n      }\n    }\n\n    if (style.filter && style.filter.length) {\n      updateContextIfNotHitCache(\n        context,\n        'filter',\n        // use raw filter string\n        object.attributes.filter,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  clearShadowAndFilterStyleForContext(\n    context: CanvasRenderingContext2D,\n    hasShadow: boolean,\n    hasFilter: boolean,\n    renderState: RenderState,\n    onlyClearShadowFilter = false,\n  ) {\n    if (hasShadow) {\n      updateContextIfNotHitCache(\n        context,\n        'shadowColor',\n        DEFAULT_STYLE.shadowColor,\n        renderState.currentContext,\n      );\n      for (let i = 0; i < SHADOW_NUMBER_STYLE.length; i++) {\n        const styleName = SHADOW_NUMBER_STYLE[i];\n        updateContextIfNotHitCache(\n          context,\n          styleName,\n          DEFAULT_STYLE[styleName],\n          renderState.currentContext,\n        );\n      }\n    }\n\n    if (hasFilter) {\n      if (hasShadow && onlyClearShadowFilter) {\n        // save drop-shadow filter\n        const oldFilter = context.filter;\n        if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n          updateContextIfNotHitCache(\n            context,\n            'filter',\n            oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() ||\n              DEFAULT_STYLE.filter,\n            renderState.currentContext,\n          );\n        }\n      } else {\n        updateContextIfNotHitCache(\n          context,\n          'filter',\n          DEFAULT_STYLE.filter,\n          renderState.currentContext,\n        );\n      }\n    }\n  }\n\n  fillToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const { fill, fillRule } = object.parsedStyle;\n    let resetStyle = null as unknown;\n\n    if (Array.isArray(fill) && fill.length > 0) {\n      fill.forEach((gradient) => {\n        const prevStyle = updateContextIfNotHitCache(\n          context,\n          'fillStyle',\n          getColor(gradient, object, context, this.imagePool),\n          renderState.currentContext,\n        );\n        resetStyle = resetStyle ?? prevStyle;\n\n        if (fillRule) {\n          context.fill(fillRule);\n        } else {\n          context.fill();\n        }\n      });\n    } else {\n      if (isPattern(fill)) {\n        const pattern = getPattern(\n          fill,\n          object,\n          context,\n          object.ownerDocument.defaultView.context,\n          plugin,\n          runtime,\n          this.imagePool,\n        );\n        if (pattern) {\n          context.fillStyle = pattern;\n          resetStyle = true;\n        }\n      }\n\n      if (fillRule) {\n        context.fill(fillRule);\n      } else {\n        context.fill();\n      }\n    }\n\n    if (resetStyle !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'fillStyle',\n        resetStyle,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  strokeToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const { stroke } = object.parsedStyle;\n    let resetStyle = null as unknown;\n\n    if (Array.isArray(stroke) && stroke.length > 0) {\n      stroke.forEach((gradient) => {\n        const prevStyle = updateContextIfNotHitCache(\n          context,\n          'strokeStyle',\n          getColor(gradient, object, context, this.imagePool),\n          renderState.currentContext,\n        );\n        resetStyle = resetStyle ?? prevStyle;\n\n        context.stroke();\n      });\n    } else {\n      if (isPattern(stroke)) {\n        const pattern = getPattern(\n          stroke,\n          object,\n          context,\n          object.ownerDocument.defaultView.context,\n          plugin,\n          runtime,\n          this.imagePool,\n        );\n        if (pattern) {\n          const prevStyle = updateContextIfNotHitCache(\n            context,\n            'strokeStyle',\n            pattern,\n            renderState.currentContext,\n          );\n          resetStyle = resetStyle ?? prevStyle;\n        }\n      }\n\n      context.stroke();\n    }\n\n    if (resetStyle !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'strokeStyle',\n        resetStyle,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n    const style = object.parsedStyle;\n    const {\n      opacity = DEFAULT_STYLE.globalAlpha,\n      fillOpacity = DEFAULT_STYLE.fillOpacity,\n      strokeOpacity = DEFAULT_STYLE.strokeOpacity,\n      lineWidth = DEFAULT_STYLE.lineWidth,\n    } = style;\n\n    const hasFill = style.fill && !(style.fill as CSSRGB).isNone;\n    const hasStroke =\n      style.stroke && !(style.stroke as CSSRGB).isNone && lineWidth > 0;\n\n    if (!hasFill && !hasStroke) {\n      return;\n    }\n\n    const hasShadow = !isNil(style.shadowColor) && style.shadowBlur > 0;\n    const isInnerShadow = style.shadowType === 'inner';\n    const isFillTransparent = (style.fill as CSSRGB)?.alpha === 0;\n    const hasFilter = !!(style.filter && style.filter.length);\n    // Shadows can only be applied to fill() or stroke(), the default is fill()\n    const shouldDrawShadowWithStroke =\n      hasShadow &&\n      hasStroke &&\n      (nodeName === Shape.PATH ||\n        nodeName === Shape.LINE ||\n        nodeName === Shape.POLYLINE ||\n        isFillTransparent ||\n        isInnerShadow);\n\n    // TODO https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/paint-order\n\n    let originGlobalAlpha: number | null = null;\n\n    if (hasFill) {\n      if (!shouldDrawShadowWithStroke) {\n        this.applyShadowAndFilterStyleToContext(\n          context,\n          object,\n          hasShadow,\n          renderState,\n        );\n      }\n\n      const updateOpacity = opacity * fillOpacity;\n\n      originGlobalAlpha = updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        updateOpacity,\n        renderState.currentContext,\n      );\n\n      this.fillToContext(context, object, renderState, plugin, runtime);\n\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilterStyleForContext(\n          context,\n          hasShadow,\n          hasFilter,\n          renderState,\n        );\n      }\n    }\n    if (hasStroke) {\n      let clearShadowAndFilter = false;\n      const updateOpacity = opacity * strokeOpacity;\n      const prevOpacity = updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        updateOpacity,\n        renderState.currentContext,\n      );\n      originGlobalAlpha = hasFill ? originGlobalAlpha : prevOpacity;\n\n      if (shouldDrawShadowWithStroke) {\n        this.applyShadowAndFilterStyleToContext(\n          context,\n          object,\n          hasShadow,\n          renderState,\n        );\n        clearShadowAndFilter = true;\n\n        if (isInnerShadow) {\n          const originBlend = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'source-atop';\n\n          this.strokeToContext(context, object, renderState, plugin, runtime);\n\n          context.globalCompositeOperation = originBlend;\n          this.clearShadowAndFilterStyleForContext(\n            context,\n            hasShadow,\n            hasFilter,\n            renderState,\n            true,\n          );\n        }\n      }\n\n      this.strokeToContext(context, object, renderState, plugin, runtime);\n\n      if (clearShadowAndFilter) {\n        this.clearShadowAndFilterStyleForContext(\n          context,\n          hasShadow,\n          hasFilter,\n          renderState,\n        );\n      }\n    }\n\n    // clear\n    if (originGlobalAlpha !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        originGlobalAlpha,\n        renderState.currentContext,\n      );\n    }\n  }\n}\n","import {\n  CanvasContext,\n  CSSGradientValue,\n  CSSRGB,\n  DisplayObject,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  Pattern,\n  isPattern,\n  Shape,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport { CanvasRendererPlugin } from '../../CanvasRendererPlugin';\nimport { OptimizedDefaultRenderer, DEFAULT_STYLE } from './OptimizedDefault';\nimport { getColor, getPattern } from './helper';\n\nexport class DefaultRenderer extends OptimizedDefaultRenderer {\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedBaseStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const {\n      fill,\n      fillRule,\n      opacity = 1,\n      fillOpacity = 1,\n      stroke,\n      strokeOpacity = 1,\n      lineWidth = 1,\n      lineCap,\n      lineJoin,\n      shadowType,\n      shadowColor,\n      shadowBlur,\n      filter,\n      miterLimit,\n    } = parsedStyle;\n    const hasFill = fill && !(fill as CSSRGB).isNone;\n    const hasStroke = stroke && !(stroke as CSSRGB).isNone && lineWidth > 0;\n\n    const isFillTransparent = (fill as CSSRGB)?.alpha === 0;\n    const hasFilter = !!(filter && filter.length);\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    const nodeName = object.nodeName as Shape;\n    const isInnerShadow = shadowType === 'inner';\n    const shouldDrawShadowWithStroke =\n      hasStroke &&\n      hasShadow &&\n      (nodeName === Shape.PATH ||\n        nodeName === Shape.LINE ||\n        nodeName === Shape.POLYLINE ||\n        isFillTransparent ||\n        isInnerShadow);\n\n    if (hasFill) {\n      context.globalAlpha = opacity * fillOpacity;\n\n      if (!shouldDrawShadowWithStroke) {\n        setShadowAndFilter(object, context, hasShadow);\n      }\n\n      applyFill(\n        context,\n        object,\n        fill,\n        fillRule,\n        canvasContext,\n        plugin,\n        runtime,\n        this.imagePool,\n      );\n\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilter(context, hasFilter, hasShadow);\n      }\n    }\n\n    if (hasStroke) {\n      context.globalAlpha = opacity * strokeOpacity;\n      context.lineWidth = lineWidth;\n      if (!isNil(miterLimit)) {\n        context.miterLimit = miterLimit;\n      }\n\n      if (!isNil(lineCap)) {\n        context.lineCap = lineCap;\n      }\n\n      if (!isNil(lineJoin)) {\n        context.lineJoin = lineJoin;\n      }\n\n      if (shouldDrawShadowWithStroke) {\n        if (isInnerShadow) {\n          context.globalCompositeOperation = 'source-atop';\n        }\n        setShadowAndFilter(object, context, true);\n\n        if (isInnerShadow) {\n          applyStroke(\n            context,\n            object,\n            stroke,\n            canvasContext,\n            plugin,\n            runtime,\n            this.imagePool,\n          );\n          context.globalCompositeOperation =\n            DEFAULT_STYLE.globalCompositeOperation;\n          this.clearShadowAndFilter(context, hasFilter, true);\n        }\n      }\n\n      applyStroke(\n        context,\n        object,\n        stroke,\n        canvasContext,\n        plugin,\n        runtime,\n        this.imagePool,\n      );\n    }\n  }\n\n  private clearShadowAndFilter(\n    context: CanvasRenderingContext2D,\n    hasFilter: boolean,\n    hasShadow: boolean,\n  ) {\n    if (hasShadow) {\n      context.shadowColor = 'transparent';\n      context.shadowBlur = 0;\n    }\n\n    if (hasFilter) {\n      // save drop-shadow filter\n      const oldFilter = context.filter;\n      if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n        context.filter =\n          oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() || 'none';\n      }\n    }\n  }\n}\n\n/**\n * apply before fill and stroke but only once\n */\nexport function setShadowAndFilter(\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  hasShadow: boolean,\n) {\n  const { filter, shadowColor, shadowBlur, shadowOffsetX, shadowOffsetY } =\n    object.parsedStyle;\n\n  if (filter && filter.length) {\n    // use raw filter string\n    context.filter = object.style.filter;\n  }\n\n  if (hasShadow) {\n    context.shadowColor = shadowColor.toString();\n    context.shadowBlur = shadowBlur || 0;\n    context.shadowOffsetX = shadowOffsetX || 0;\n    context.shadowOffsetY = shadowOffsetY || 0;\n  }\n}\n\nexport function applyFill(\n  context: CanvasRenderingContext2D,\n  object: DisplayObject,\n  fill: CSSRGB | CSSGradientValue[] | Pattern,\n  fillRule: 'nonzero' | 'evenodd',\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n  skipFill = false,\n) {\n  if (Array.isArray(fill)) {\n    fill.forEach((gradient) => {\n      context.fillStyle = getColor(gradient, object, context, imagePool);\n      if (!skipFill) {\n        fillRule ? context.fill(fillRule) : context.fill();\n      }\n    });\n  } else {\n    if (isPattern(fill)) {\n      context.fillStyle = getPattern(\n        fill,\n        object,\n        context,\n        canvasContext,\n        plugin,\n        runtime,\n        imagePool,\n      );\n    }\n    if (!skipFill) {\n      fillRule ? context.fill(fillRule) : context.fill();\n    }\n  }\n}\n\nexport function applyStroke(\n  context: CanvasRenderingContext2D,\n  object: DisplayObject,\n  stroke: CSSRGB | CSSGradientValue[] | Pattern,\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n  skipStroke = false,\n) {\n  if (Array.isArray(stroke)) {\n    stroke.forEach((gradient) => {\n      context.strokeStyle = getColor(gradient, object, context, imagePool);\n      if (!skipStroke) {\n        context.stroke();\n      }\n    });\n  } else {\n    if (isPattern(stroke)) {\n      context.strokeStyle = getPattern(\n        stroke,\n        object,\n        context,\n        canvasContext,\n        plugin,\n        runtime,\n        imagePool,\n      );\n    }\n    if (!skipStroke) {\n      context.stroke();\n    }\n  }\n}\n","import { vec3, mat4 } from 'gl-matrix';\n\n/**\n * 判断两个点是否重合，点坐标的格式为 [x, y]\n */\nexport function isSamePoint(\n  point1: [number, number],\n  point2: [number, number],\n) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n}\n\nexport function calculateOverlapRect<\n  Rect extends [number, number, number, number],\n>(rect1: Rect, rect2: Rect): null | Rect {\n  const [x1, y1, w1, h1] = rect1;\n  const [x2, y2, w2, h2] = rect2;\n\n  // 计算重叠区域的左上角和右下角\n  const overlapLeft = Math.max(x1, x2);\n  const overlapTop = Math.max(y1, y2);\n  const overlapRight = Math.min(x1 + w1, x2 + w2);\n  const overlapBottom = Math.min(y1 + h1, y2 + h2);\n\n  if (overlapRight <= overlapLeft || overlapBottom <= overlapTop) {\n    return null;\n  }\n\n  return [\n    overlapLeft,\n    overlapTop,\n    overlapRight - overlapLeft,\n    overlapBottom - overlapTop,\n  ] as Rect;\n}\n\nexport function transformRect<Rect extends [number, number, number, number]>(\n  rect: Rect,\n  matrix: mat4,\n): Rect {\n  const tl = vec3.transformMat4(vec3.create(), [rect[0], rect[1], 0], matrix);\n  const tr = vec3.transformMat4(\n    vec3.create(),\n    [rect[0] + rect[2], rect[1], 0],\n    matrix,\n  );\n  const bl = vec3.transformMat4(\n    vec3.create(),\n    [rect[0], rect[1] + rect[3], 0],\n    matrix,\n  );\n  const br = vec3.transformMat4(\n    vec3.create(),\n    [rect[0] + rect[2], rect[1] + rect[3], 0],\n    matrix,\n  );\n\n  return [\n    Math.min(tl[0], tr[0], bl[0], br[0]),\n    Math.min(tl[1], tr[1], bl[1], br[1]),\n    Math.max(tl[0], tr[0], bl[0], br[0]) - Math.min(tl[0], tr[0], bl[0], br[0]),\n    Math.max(tl[1], tr[1], bl[1], br[1]) - Math.min(tl[1], tr[1], bl[1], br[1]),\n  ] as Rect;\n}\n","import type {\n  DisplayObject,\n  ParsedImageStyleProps,\n  GlobalRuntime,\n} from '@antv/g-lite';\nimport { ImagePool, type ImageCache } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport { mat4 } from 'gl-matrix';\nimport { transformRect, calculateOverlapRect } from '../../utils/math';\nimport { DefaultRenderer, setShadowAndFilter } from './Default';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport class ImageRenderer extends DefaultRenderer {\n  static renderFull(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      image: HTMLImageElement;\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    context.drawImage(\n      data.image,\n      Math.floor(data.drawRect[0]),\n      Math.floor(data.drawRect[1]),\n      Math.ceil(data.drawRect[2]),\n      Math.ceil(data.drawRect[3]),\n    );\n  }\n\n  private renderDownSampled(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      src: string | HTMLImageElement;\n      imageCache: ImageCache;\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    const { src, imageCache } = data;\n\n    if (!imageCache.downSampled) {\n      this.imagePool\n        .createDownSampledImage(src, object)\n        .then(() => {\n          // be removed from dom tree\n          if (!object.ownerDocument) {\n            return;\n          }\n\n          // rerender\n          object.dirty();\n          object.ownerDocument.defaultView.context.renderingService.dirtify();\n        })\n        .catch((reason) => {\n          console.error(reason);\n        });\n\n      return;\n    }\n\n    context.drawImage(\n      imageCache.downSampled,\n      Math.floor(data.drawRect[0]),\n      Math.floor(data.drawRect[1]),\n      Math.ceil(data.drawRect[2]),\n      Math.ceil(data.drawRect[3]),\n    );\n  }\n\n  renderTile(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      src: string | HTMLImageElement;\n      imageCache: ImageCache;\n      imageRect: [number, number, number, number];\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    const { src, imageCache, imageRect, drawRect } = data;\n    const { size: originalSize } = imageCache;\n    const { a, b, c, d, e, f } = context.getTransform();\n\n    context.resetTransform();\n\n    if (!imageCache?.gridSize) {\n      this.imagePool\n        .createImageTiles(\n          src,\n          [],\n          () => {\n            // be removed from dom tree\n            if (!object.ownerDocument) {\n              return;\n            }\n\n            // rerender\n            object.dirty();\n            object.ownerDocument.defaultView.context.renderingService.dirtify();\n          },\n          object,\n        )\n        .catch((reason) => {\n          console.error(reason);\n        });\n\n      return;\n    }\n\n    const scaleToOrigin = [\n      originalSize[0] / imageRect[2],\n      originalSize[1] / imageRect[3],\n    ];\n    const scaledTileSize = [\n      imageCache.tileSize[0] / scaleToOrigin[0],\n      imageCache.tileSize[1] / scaleToOrigin[1],\n    ];\n    const [startTileX, endTileX] = [\n      Math.floor((drawRect[0] - imageRect[0]) / scaledTileSize[0]),\n      Math.ceil((drawRect[0] + drawRect[2] - imageRect[0]) / scaledTileSize[0]),\n    ];\n    const [startTileY, endTileY] = [\n      Math.floor((drawRect[1] - imageRect[1]) / scaledTileSize[1]),\n      Math.ceil((drawRect[1] + drawRect[3] - imageRect[1]) / scaledTileSize[1]),\n    ];\n\n    for (let tileY = startTileY; tileY <= endTileY; tileY++) {\n      for (let tileX = startTileX; tileX <= endTileX; tileX++) {\n        const item = imageCache.tiles[tileY][tileX];\n\n        if (item) {\n          const tileRect = [\n            Math.floor(imageRect[0] + item.tileX * scaledTileSize[0]),\n            Math.floor(imageRect[1] + item.tileY * scaledTileSize[1]),\n            Math.ceil(scaledTileSize[0]),\n            Math.ceil(scaledTileSize[1]),\n          ];\n\n          context.drawImage(\n            item.data,\n            tileRect[0],\n            tileRect[1],\n            tileRect[2],\n            tileRect[3],\n          );\n        }\n      }\n    }\n\n    context.setTransform(a, b, c, d, e, f);\n  }\n\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n  ) {\n    const {\n      x = 0,\n      y = 0,\n      width,\n      height,\n      src,\n      shadowColor,\n      shadowBlur,\n    } = parsedStyle;\n\n    const imageCache = this.imagePool.getImageSync(src, object);\n    const image = imageCache?.img;\n    let iw = width;\n    let ih = height;\n\n    if (!image) {\n      return;\n    }\n\n    iw ||= image.width;\n    ih ||= image.height;\n\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n\n    // node-canvas will throw the following err:\n    // Error: Image given has not completed loading\n    try {\n      const { width: viewWidth, height: viewHeight } =\n        object.ownerDocument.defaultView.getContextService().getDomElement();\n\n      const currentTransform = context.getTransform();\n      const { a, b, c, d, e, f } = currentTransform;\n      // 构建 mat4 矩阵\n      // prettier-ignore\n      const transformMatrix = mat4.fromValues(\n          a, c, 0, 0,\n          b, d, 0, 0,\n          0, 0, 1, 0,\n          e, f, 0, 1,\n        );\n      const imageRect = transformRect([x, y, iw, ih], transformMatrix);\n      const drawRect = calculateOverlapRect(\n        [0, 0, viewWidth, viewHeight],\n        imageRect,\n      );\n\n      if (!drawRect) {\n        return;\n      }\n\n      if (\n        !object.ownerDocument.defaultView.getConfig()\n          .enableLargeImageOptimization\n      ) {\n        ImageRenderer.renderFull(context, parsedStyle, object, {\n          image,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      const sizeOfOrigin = imageRect[2] / imageCache.size[0];\n\n      if (sizeOfOrigin < (imageCache.downSamplingRate || 0.5)) {\n        this.renderDownSampled(context, parsedStyle, object, {\n          src,\n          imageCache,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      if (!ImagePool.isSupportTile) {\n        ImageRenderer.renderFull(context, parsedStyle, object, {\n          image,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      this.renderTile(context, parsedStyle, object, {\n        src,\n        imageCache,\n        imageRect,\n        drawRect,\n      });\n    } catch {\n      // expected error\n    }\n  }\n\n  // ---\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    this.render(context, object.parsedStyle as ParsedImageStyleProps, object);\n  }\n}\n","import {\n  type CSSRGB,\n  type CanvasContext,\n  type DisplayObject,\n  type GlobalRuntime,\n  type ParsedTextStyleProps,\n  type Rectangle,\n  CSSGradientValue,\n  Pattern,\n} from '@antv/g-lite';\nimport { isNil } from '@antv/util';\nimport {\n  DefaultRenderer,\n  applyFill,\n  applyStroke,\n  setShadowAndFilter,\n} from './Default';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport class TextRenderer extends DefaultRenderer {\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedTextStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    // Trigger text geometry calculation.\n    object.getBounds();\n    const {\n      lineWidth = 1,\n      textAlign = 'start',\n      textBaseline = 'alphabetic',\n      lineJoin = 'miter',\n      miterLimit = 10,\n      letterSpacing = 0,\n      stroke,\n      fill,\n      fillRule,\n      fillOpacity = 1,\n      strokeOpacity = 1,\n      opacity = 1,\n      metrics,\n      x = 0,\n      y = 0,\n      dx,\n      dy,\n      shadowColor,\n      shadowBlur,\n    } = parsedStyle;\n\n    const { font, lines, height, lineHeight, lineMetrics } = metrics;\n\n    context.font = font;\n    context.lineWidth = lineWidth;\n    context.textAlign = textAlign === 'middle' ? 'center' : textAlign;\n\n    let formattedTextBaseline = textBaseline;\n    if (formattedTextBaseline === 'alphabetic') {\n      formattedTextBaseline = 'bottom';\n    }\n\n    context.lineJoin = lineJoin;\n    if (!isNil(miterLimit)) {\n      context.miterLimit = miterLimit;\n    }\n\n    let linePositionY = y;\n    // handle vertical text baseline\n    if (textBaseline === 'middle') {\n      linePositionY += -height / 2 - lineHeight / 2;\n    } else if (\n      textBaseline === 'bottom' ||\n      textBaseline === 'alphabetic' ||\n      textBaseline === 'ideographic'\n    ) {\n      linePositionY += -height;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      linePositionY += -lineHeight;\n    }\n\n    // account for dx & dy\n    const offsetX = x + (dx || 0);\n    linePositionY += dy || 0;\n\n    if (lines.length === 1) {\n      if (formattedTextBaseline === 'bottom') {\n        formattedTextBaseline = 'middle';\n        linePositionY -= 0.5 * height;\n      } else if (formattedTextBaseline === 'top') {\n        formattedTextBaseline = 'middle';\n        linePositionY += 0.5 * height;\n      }\n    }\n    context.textBaseline = formattedTextBaseline;\n\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n\n    // draw lines line by line\n    for (let i = 0; i < lines.length; i++) {\n      const linePositionX = lineWidth / 2 + offsetX;\n      linePositionY += lineHeight;\n\n      // no need to re-position X, cause we already set text align\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign\n      if (!isNil(stroke) && !(stroke as CSSRGB).isNone && lineWidth) {\n        this.drawLetterSpacing(\n          context,\n          object,\n          lines[i],\n          lineMetrics[i],\n          textAlign,\n          linePositionX,\n          linePositionY,\n          letterSpacing,\n          fill,\n          fillRule,\n          fillOpacity,\n          stroke,\n          strokeOpacity,\n          opacity,\n          true,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      if (!isNil(fill)) {\n        this.drawLetterSpacing(\n          context,\n          object,\n          lines[i],\n          lineMetrics[i],\n          textAlign,\n          linePositionX,\n          linePositionY,\n          letterSpacing,\n          fill,\n          fillRule,\n          fillOpacity,\n          stroke,\n          strokeOpacity,\n          opacity,\n          false,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n    }\n  }\n\n  private drawLetterSpacing(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    lineMetrics: Rectangle,\n    textAlign: CanvasTextAlign | 'middle',\n    x: number,\n    y: number,\n    letterSpacing: number,\n    fill: CSSRGB | CSSGradientValue[] | Pattern,\n    fillRule: 'nonzero' | 'evenodd',\n    fillOpacity: number | undefined,\n    stroke: CSSRGB | CSSGradientValue[] | Pattern,\n    strokeOpacity: number | undefined,\n    opacity: number | undefined,\n    isStroke: boolean,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ): void {\n    // letterSpacing of 0 means normal, render all texts directly\n    if (letterSpacing === 0) {\n      if (isStroke) {\n        this.strokeText(\n          context,\n          object,\n          text,\n          x,\n          y,\n          stroke,\n          strokeOpacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      } else {\n        this.fillText(\n          context,\n          object,\n          text,\n          x,\n          y,\n          fill,\n          fillRule,\n          fillOpacity,\n          opacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      return;\n    }\n\n    // draw text using left align\n    const currentTextAlign = context.textAlign;\n    context.textAlign = 'left';\n\n    let currentPosition = x;\n    if (textAlign === 'center' || textAlign === 'middle') {\n      currentPosition = x - lineMetrics.width / 2;\n    } else if (textAlign === 'right' || textAlign === 'end') {\n      currentPosition = x - lineMetrics.width;\n    }\n\n    const stringArray = Array.from(text);\n    let previousWidth = context.measureText(text).width;\n    let currentWidth = 0;\n    for (let i = 0; i < stringArray.length; ++i) {\n      const currentChar = stringArray[i];\n      if (isStroke) {\n        this.strokeText(\n          context,\n          object,\n          currentChar,\n          currentPosition,\n          y,\n          stroke,\n          strokeOpacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      } else {\n        this.fillText(\n          context,\n          object,\n          currentChar,\n          currentPosition,\n          y,\n          fill,\n          fillRule,\n          fillOpacity,\n          opacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      currentWidth = context.measureText(text.substring(i + 1)).width;\n      currentPosition += previousWidth - currentWidth + letterSpacing;\n      previousWidth = currentWidth;\n    }\n\n    context.textAlign = currentTextAlign;\n  }\n\n  private fillText(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    x: number,\n    y: number,\n    fill: CSSRGB | CSSGradientValue[] | Pattern,\n    fillRule: 'nonzero' | 'evenodd',\n    fillOpacity: number | undefined,\n    opacity: number | undefined,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    applyFill(\n      context,\n      object,\n      fill,\n      fillRule,\n      canvasContext,\n      plugin,\n      runtime,\n      this.imagePool,\n      true,\n    );\n\n    let currentGlobalAlpha: number;\n    const applyOpacity = !isNil(fillOpacity) && fillOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = fillOpacity * opacity;\n    }\n    context.fillText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  }\n\n  private strokeText(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    x: number,\n    y: number,\n    stroke: CSSRGB | CSSGradientValue[] | Pattern,\n    strokeOpacity: number | undefined,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    applyStroke(\n      context,\n      object,\n      stroke,\n      canvasContext,\n      plugin,\n      runtime,\n      this.imagePool,\n      true,\n    );\n\n    let currentGlobalAlpha: number;\n    const applyOpacity = !isNil(strokeOpacity) && strokeOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = strokeOpacity!;\n    }\n    context.strokeText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  }\n\n  // ---\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    this.render(\n      context,\n      object.parsedStyle as ParsedTextStyleProps,\n      object,\n      object.ownerDocument.defaultView.context,\n      plugin,\n      runtime,\n    );\n  }\n}\n","import { AbstractRendererPlugin, Shape } from '@antv/g-lite';\nimport type { PathGenerator } from '@antv/g-plugin-canvas-path-generator';\nimport { CanvasRendererPlugin } from './CanvasRendererPlugin';\nimport {\n  type StyleRenderer,\n  DefaultRenderer,\n  TextRenderer,\n  ImageRenderer,\n} from './shapes/styles';\nimport type { CanvasRendererPluginOptions } from './interfaces';\n\nexport * from './shapes/styles';\n\nexport class Plugin extends AbstractRendererPlugin<{\n  defaultStyleRendererFactory: Record<Shape, StyleRenderer>;\n  styleRendererFactory: Record<Shape, StyleRenderer>;\n  pathGeneratorFactory: Record<Shape, PathGenerator<any>>;\n}> {\n  name = 'canvas-renderer';\n\n  constructor(private options: Partial<CanvasRendererPluginOptions> = {}) {\n    super();\n  }\n\n  init(): void {\n    const canvasRendererPluginOptions: CanvasRendererPluginOptions = {\n      dirtyObjectNumThreshold: 500,\n      dirtyObjectRatioThreshold: 0.8,\n      ...this.options,\n    };\n\n    // @ts-ignore\n    const { imagePool } = this.context;\n\n    const defaultRenderer = new DefaultRenderer(imagePool);\n\n    const defaultStyleRendererFactory: Record<Shape, StyleRenderer> = {\n      [Shape.CIRCLE]: defaultRenderer,\n      [Shape.ELLIPSE]: defaultRenderer,\n      [Shape.RECT]: defaultRenderer,\n      [Shape.IMAGE]: new ImageRenderer(imagePool),\n      [Shape.TEXT]: new TextRenderer(imagePool),\n      [Shape.LINE]: defaultRenderer,\n      [Shape.POLYLINE]: defaultRenderer,\n      [Shape.POLYGON]: defaultRenderer,\n      [Shape.PATH]: defaultRenderer,\n      [Shape.GROUP]: undefined,\n      [Shape.HTML]: undefined,\n      [Shape.MESH]: undefined,\n      [Shape.FRAGMENT]: undefined,\n    };\n\n    this.context.defaultStyleRendererFactory = defaultStyleRendererFactory;\n    this.context.styleRendererFactory = defaultStyleRendererFactory;\n\n    this.addRenderingPlugin(\n      new CanvasRendererPlugin(canvasRendererPluginOptions),\n    );\n  }\n  destroy(): void {\n    this.removeAllRenderingPlugins();\n\n    delete this.context.defaultStyleRendererFactory;\n    delete this.context.styleRendererFactory;\n  }\n}\n"],"names":["_renderState","_classPrivateFieldLooseKey","CanvasRendererPlugin","canvasRendererPluginOptions","_classCallCheck","removedRBushNodeAABBs","renderQueue","Object","defineProperty","writable","value","restoreStack","prevObject","currentContext","Map","clearFullScreenLastFrame","clearFullScreen","vpMatrix","mat4","create","dprMatrix","tmpMat4","vec3a","vec3","vec3b","vec3c","vec3d","_createClass","key","apply","context","runtime","_this","_this$context","config","camera","renderingService","renderingContext","rBushRoot","pathGeneratorFactory","enableRenderingOptimization","renderer","getConfig","enableDirtyCheck","enableDirtyRectangleRendering","rBush","contextService","canvas","root","ownerDocument","defaultView","handleUnmounted","e","object","target","rBushNode","aabb","push","handleCulled","hooks","init","tap","tag","addEventListener","ElementEvent","UNMOUNTED","CULLED","dpr","getDPR","width","height","getContext","clearRect","background","destroy","removeEventListener","_classPrivateFieldLooseBase","beforeDraw","_canvas$context$rende","_this$canvasRendererP","dirtyObjectNumThreshold","dirtyObjectRatioThreshold","_renderingService$get","getStats","total","rendered","ratio","renderingPlugins","isFirstTimeRenderingFinished","disableDirtyRectangleRendering","resetTransform","setTransform","renderByZIndex","stack","length","_currentObject$sortab","currentObject","pop","isVisible","isCulled","renderDisplayObjectOptimized","renderDisplayObject","objects","sortable","sorted","childNodes","i","endFrame","clear","fromScaling","multiply","getOrthoMatrix","save","restore","dirtyRenderBounds","safeMergeAABB","mergeDirtyAABBs","concat","_toConsumableArray","map","_ref","minX","minY","maxX","maxY","AABB","setMinMax","isEmpty","dirtyRect","convertAABB2Rect","x","y","tl","transformMat4","tr","bl","br","minx","Math","min","miny","maxx","max","maxy","ix","floor","iy","iwidth","ceil","iheight","beginPath","rect","clip","_config$renderer$getC","enableDirtyRectangleRenderingDebug","dispatchEvent","CustomEvent","CanvasEvent","DIRTY_RECTANGLE","dirtyObjects","searchDirtyObjects","sort","a","b","renderOrder","forEach","saveDirtyAABB","render","fillStyle","fillRect","canvasContext","renderState","nodeName","updateTransform","clipDraw","styleRenderer","styleRendererFactory","generatePath","clipPath","parsedStyle","exactEquals","getWorldTransform","applyWorldTransform","closePath","forceUpdateStyle","prevNodeName","Shape","TEXT","IMAGE","applyStyleToContext","LINE","PATH","POLYLINE","drawToContext","dirty","parent","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINS","applyAttributesToContext","_ref2","stroke","fill","opacity","lineDash","lineDashOffset","setLineDash","isNil","globalAlpha","Array","isArray","isNone","strokeStyle","attributes","getMin","getMax","renderBounds","getRenderBounds","add","renderable","dirtyRectangle","_dirtyRectangle$getMi","_dirtyRectangle$getMi2","_slicedToArray","_dirtyRectangle$getMa","_dirtyRectangle$getMa2","rBushNodes","search","_ref3","displayObject","update","center","halfExtents","matrix","copy","getLocalTransform","merged","_len","arguments","aabbs","_key","getPattern","pattern","plugin","imagePool","$offscreenCanvas","image","_parsedStyle","offscreenCanvas","offscreenCanvasCreator","getOrCreateCanvas","offscreenCanvasContext","getOrCreateContext","canvasPattern","getOrCreatePatternSync","getGeometryBounds","dirtify","getColor","parsedColor","color","type","GradientType","LinearGradient","RadialGradient","bounds","getOrCreateGradient","_objectSpread","SHADOW_NUMBER_STYLE","STROKE_STYLE","DEFAULT_STYLE","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","filter","globalCompositeOperation","strokeOpacity","lineWidth","lineCap","lineJoin","miterLimit","fillOpacity","defaultParsedStyle","updateContextIfNotHitCache","cache","prevValue","has","get","set","OptimizedDefaultRenderer","applyCommonStyleToContext","forceUpdate","prevStyle","style","blend","applyStrokeFillStyleToContext","_style$lineWidth","hasFill","hasStroke","styleName","applyShadowAndFilterStyleToContext","hasShadow","toString","clearShadowAndFilterStyleForContext","hasFilter","onlyClearShadowFilter","undefined","oldFilter","indexOf","replace","trim","fillToContext","_object$parsedStyle","fillRule","resetStyle","gradient","isPattern","strokeToContext","_this2","_style$fill","_style$opacity","_style$fillOpacity","_style$strokeOpacity","_style$lineWidth2","isInnerShadow","shadowType","isFillTransparent","alpha","shouldDrawShadowWithStroke","originGlobalAlpha","updateOpacity","clearShadowAndFilter","prevOpacity","originBlend","DefaultRenderer","_OptimizedDefaultRend","_callSuper","_inherits","_parsedStyle$opacity","_parsedStyle$fillOpac","_parsedStyle$strokeOp","_parsedStyle$lineWidt","setShadowAndFilter","applyFill","applyStroke","skipFill","skipStroke","calculateOverlapRect","rect1","rect2","_rect","x1","y1","w1","h1","_rect2","x2","y2","w2","h2","overlapLeft","overlapTop","overlapRight","overlapBottom","transformRect","ImageRenderer","_DefaultRenderer","renderDownSampled","data","src","imageCache","downSampled","createDownSampledImage","then","reason","console","error","drawImage","drawRect","renderTile","imageRect","originalSize","size","_context$getTransform","getTransform","c","d","f","gridSize","createImageTiles","scaleToOrigin","scaledTileSize","tileSize","startTileX","endTileX","startTileY","endTileY","tileY","tileX","item","tiles","tileRect","_parsedStyle$x","_parsedStyle$y","getImageSync","img","iw","ih","_object$ownerDocument","getContextService","getDomElement","viewWidth","viewHeight","currentTransform","transformMatrix","fromValues","enableLargeImageOptimization","renderFull","sizeOfOrigin","downSamplingRate","ImagePool","isSupportTile","_unused","TextRenderer","getBounds","_parsedStyle$textAlig","textAlign","_parsedStyle$textBase","textBaseline","_parsedStyle$lineJoin","_parsedStyle$miterLim","_parsedStyle$letterSp","letterSpacing","metrics","dx","dy","font","lines","lineHeight","lineMetrics","formattedTextBaseline","linePositionY","offsetX","linePositionX","drawLetterSpacing","text","isStroke","strokeText","fillText","currentTextAlign","currentPosition","stringArray","from","previousWidth","measureText","currentWidth","currentChar","substring","currentGlobalAlpha","applyOpacity","Plugin","_AbstractRendererPlug","options","name","_defaultStyleRenderer","defaultRenderer","defaultStyleRendererFactory","_defineProperty","CIRCLE","ELLIPSE","RECT","POLYGON","GROUP","HTML","MESH","FRAGMENT","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"mappings":"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"}