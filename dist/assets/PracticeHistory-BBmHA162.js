var e=(e,s,a)=>new Promise((t,l)=>{var i=e=>{try{o(a.next(e))}catch(s){l(s)}},r=e=>{try{o(a.throw(e))}catch(s){l(s)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,r);o((a=a.apply(e,s)).next())});/* empty css             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                         *//* empty css                *//* empty css                *//* empty css                  *//* empty css                     */import{y as s,r as a,l as t,j as l,z as i,B as r,R as o,J as c,A as n,Q as u,a5 as d,I as p,u as m,O as v,L as y,P as f,D as g,aB as h}from"./vue-vendor-BRizdQXW.js";import{l as k,A as _,Y as b,P as j,Z as w,W as C,v as z,a as I,E as x,F as S}from"./index-CgjG02ur.js";import{u as V}from"./practice-Bc4ZWhMF.js";import{u as $}from"./course-Ba9mJaVD.js";import{E as P,H as Q,b as B,d as U,y as A,B as T,e as D,h as E,S as F,C as L,A as H,F as O}from"./element-plus-1qB5igSe.js";import{_ as q}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./storage-B26rRKbu.js";import"./index-BKrBH71_.js";const G={class:"practice-history"},J={class:"card-header"},K={class:"header-actions"},M={key:0,class:"loading-container"},N={key:1,class:"empty-state"},R={class:"empty-icon"},W={key:2,class:"history-list"},X={class:"item-header"},Y={class:"course-info"},Z={class:"course-title"},ee={class:"session-id"},se={class:"status-info"},ae={class:"create-time"},te={class:"item-content"},le={class:"stats-grid"},ie={class:"stat-item"},re={class:"stat-value"},oe={class:"stat-item"},ce={class:"stat-value"},ne={key:0,class:"stat-item"},ue={class:"stat-value"},de={key:1,class:"stat-item"},pe={class:"stat-value"},me={key:2,class:"stat-item"},ve={class:"stat-value"},ye={key:0,class:"progress-info"},fe={class:"progress-bar"},ge={class:"progress-text"},he={class:"item-actions"},ke={key:3,class:"pagination-container"},_e=q(s({__name:"PracticeHistory",setup(s){k.add(_,b,j,w,C,z,I,x);const q=h(),_e=V(),be=$(),je=a(!1),we=a([]),Ce=a([]),ze=t({courseId:"",status:"",keyword:""}),Ie=t({page:1,pageSize:10,total:0});l(()=>e(null,null,function*(){yield xe(),yield Se()}));const xe=()=>e(null,null,function*(){try{const e=yield be.fetchCourses();Ce.value=e.courses}catch(e){console.error("获取课程列表失败:",e)}}),Se=()=>e(null,null,function*(){try{je.value=!0;const e={page:Ie.page,pageSize:Ie.pageSize,courseId:ze.courseId||void 0,status:ze.status||void 0,keyword:ze.keyword||void 0},s=yield _e.fetchPracticeSessions(e);we.value=s.sessions,Ie.total=s.total}catch(e){console.error("加载练习记录失败:",e),P.error("加载练习记录失败")}finally{je.value=!1}}),Ve=()=>{Ie.page=1,Se()},$e=()=>{clearTimeout(Pe),Pe=setTimeout(()=>{Ie.page=1,Se()},500)};let Pe;const Qe=()=>{ze.courseId="",ze.status="",ze.keyword="",Ie.page=1,Se()},Be=()=>{Se()},Ue=e=>{Ie.pageSize=e,Ie.page=1,Se()},Ae=e=>{Ie.page=e,Se()},Te=e=>{const s=Ce.value.find(s=>s.id===e);return(null==s?void 0:s.title)||"未知课程"},De=e=>{switch(e){case"completed":return"success";case"in_progress":return"warning";default:return"info"}},Ee=e=>{switch(e){case"completed":return"已完成";case"in_progress":return"进行中";default:return"未知"}},Fe=e=>{if(e<60)return`${e}秒`;const s=Math.floor(e/60),a=e%60;return a>0?`${s}分${a}秒`:`${s}分钟`},Le=()=>{q.push("/practice")};return(s,a)=>{const t=T,l=A,h=U,k=D,_=E,b=B,j=Q,w=F,C=L,z=H;return n(),i("div",G,[a[20]||(a[20]=r("div",{class:"page-header"},[r("h1",null,"练习历史"),r("p",null,"查看您的练习记录和成绩")],-1)),o(j,{class:"filter-card"},{default:c(()=>[o(b,{model:ze,inline:""},{default:c(()=>[o(h,{label:"课程"},{default:c(()=>[o(l,{modelValue:ze.courseId,"onUpdate:modelValue":a[0]||(a[0]=e=>ze.courseId=e),placeholder:"选择课程",clearable:"",onChange:Ve},{default:c(()=>[(n(!0),i(u,null,d(Ce.value,e=>(n(),p(t,{key:e.id,label:e.title,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(h,{label:"状态"},{default:c(()=>[o(l,{modelValue:ze.status,"onUpdate:modelValue":a[1]||(a[1]=e=>ze.status=e),placeholder:"选择状态",clearable:"",onChange:Ve},{default:c(()=>[o(t,{label:"全部",value:""}),o(t,{label:"已完成",value:"completed"}),o(t,{label:"进行中",value:"in_progress"})]),_:1},8,["modelValue"])]),_:1}),o(h,{label:"关键词"},{default:c(()=>[o(k,{modelValue:ze.keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>ze.keyword=e),placeholder:"搜索练习记录",clearable:"",onInput:$e},{prefix:c(()=>[o(m(S),{icon:["fas","search"]})]),_:1},8,["modelValue"])]),_:1}),o(h,null,{default:c(()=>[o(_,{type:"primary",onClick:Ve},{default:c(()=>[o(m(S),{icon:["fas","filter"],class:"mr-2"}),a[5]||(a[5]=v(" 筛选 ",-1))]),_:1}),o(_,{onClick:Qe},{default:c(()=>[o(m(S),{icon:["fas","refresh"],class:"mr-2"}),a[6]||(a[6]=v(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(j,{class:"history-list-card"},{header:c(()=>[r("div",J,[a[8]||(a[8]=r("span",null,"练习记录",-1)),r("div",K,[o(_,{onClick:Be},{default:c(()=>[o(m(S),{icon:["fas","sync-alt"],class:"mr-2"}),a[7]||(a[7]=v(" 刷新 ",-1))]),_:1})])])]),default:c(()=>[je.value?(n(),i("div",M,[o(w,{rows:5,animated:""})])):0===we.value.length?(n(),i("div",N,[r("div",R,[o(m(S),{icon:["fas","history"]})]),a[10]||(a[10]=r("h3",null,"暂无练习记录",-1)),a[11]||(a[11]=r("p",null,"您还没有任何练习记录，快去开始练习吧！",-1)),o(_,{type:"primary",onClick:Le},{default:c(()=>[o(m(S),{icon:["fas","play"],class:"mr-2"}),a[9]||(a[9]=v(" 开始练习 ",-1))]),_:1})])):(n(),i("div",W,[(n(!0),i(u,null,d(we.value,s=>{return n(),i("div",{key:s.id,class:"history-item"},[r("div",X,[r("div",Y,[r("h3",Z,f(Te(s.courseId)),1),r("p",ee,"练习ID: "+f(s.id),1)]),r("div",se,[o(C,{type:De(s.status)},{default:c(()=>[v(f(Ee(s.status)),1)]),_:2},1032,["type"]),r("span",ae,f((t=s.createdAt,new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1)])]),r("div",te,[r("div",le,[r("div",ie,[r("div",re,f(s.totalQuestions),1),a[12]||(a[12]=r("div",{class:"stat-label"},"总题数",-1))]),r("div",oe,[r("div",ce,f(s.answeredQuestions),1),a[13]||(a[13]=r("div",{class:"stat-label"},"已答题",-1))]),"completed"===s.status?(n(),i("div",ne,[r("div",ue,f(s.correctQuestions),1),a[14]||(a[14]=r("div",{class:"stat-label"},"正确数",-1))])):y("",!0),"completed"===s.status?(n(),i("div",de,[r("div",pe,f(s.score||0)+"分",1),a[15]||(a[15]=r("div",{class:"stat-label"},"得分",-1))])):y("",!0),s.duration?(n(),i("div",me,[r("div",ve,f(Fe(s.duration)),1),a[16]||(a[16]=r("div",{class:"stat-label"},"用时",-1))])):y("",!0)]),"in_progress"===s.status?(n(),i("div",ye,[r("div",fe,[r("div",{class:"progress-fill",style:g({width:s.answeredQuestions/s.totalQuestions*100+"%"})},null,4)]),r("span",ge," 进度: "+f(s.answeredQuestions)+"/"+f(s.totalQuestions),1)])):y("",!0)]),r("div",he,["in_progress"===s.status?(n(),p(_,{key:0,type:"primary",onClick:e=>(e=>{q.push(`/practice/${e.courseId}/session/${e.id}`)})(s)},{default:c(()=>[o(m(S),{icon:["fas","play"],class:"mr-2"}),a[17]||(a[17]=v(" 继续练习 ",-1))]),_:1},8,["onClick"])):y("",!0),"completed"===s.status?(n(),p(_,{key:1,type:"success",onClick:e=>(e=>{q.push(`/practice/${e.courseId}/result/${e.id}`)})(s)},{default:c(()=>[o(m(S),{icon:["fas","chart-line"],class:"mr-2"}),a[18]||(a[18]=v(" 查看结果 ",-1))]),_:1},8,["onClick"])):y("",!0),o(_,{onClick:a=>(s=>e(null,null,function*(){try{yield O.confirm(`确定要删除练习记录"${s.id}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield _e.deletePracticeSession(s.id),P.success("删除成功"),yield Se()}catch(e){"cancel"!==e&&(console.error("删除练习记录失败:",e),P.error("删除失败"))}}))(s)},{default:c(()=>[o(m(S),{icon:["fas","trash"],class:"mr-2"}),a[19]||(a[19]=v(" 删除 ",-1))]),_:1},8,["onClick"])])]);var t}),128))])),Ie.total>0?(n(),i("div",ke,[o(z,{"current-page":Ie.page,"onUpdate:currentPage":a[3]||(a[3]=e=>Ie.page=e),"page-size":Ie.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>Ie.pageSize=e),"page-sizes":[10,20,50,100],total:Ie.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ue,onCurrentChange:Ae},null,8,["current-page","page-size","total"])])):y("",!0)]),_:1})])}}}),[["__scopeId","data-v-b0b081f4"]]);export{_e as default};
