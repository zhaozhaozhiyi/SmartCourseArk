var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,u=(e,n,s)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,o=(t,e)=>{for(var n in e||(e={}))i.call(e,n)&&u(t,n,e[n]);if(s)for(var n of s(e))r.call(e,n)&&u(t,n,e[n]);return t},l=(t,s)=>e(t,n(s)),d=(t,e,n)=>new Promise((s,i)=>{var r=t=>{try{o(n.next(t))}catch(e){i(e)}},u=t=>{try{o(n.throw(t))}catch(e){i(e)}},o=t=>t.done?s(t.value):Promise.resolve(t.value).then(r,u);o((n=n.apply(t,e)).next())}),a=(t=>(t.DRAFT="draft",t.PUBLISHED="published",t.ARCHIVED="archived",t))(a||{}),S=(t=>(t.SINGLE="single",t.MULTIPLE="multiple",t.JUDGE="judge",t.FILL="fill",t.ESSAY="essay",t))(S||{}),h=(t=>(t.EASY="easy",t.MEDIUM="medium",t.HARD="hard",t))(h||{});const c={COURSES:"courses",CHAPTERS:"chapters",QUESTIONS:"questions",QUESTION_BANKS:"question_banks",QUESTION_GROUPS:"question_groups",LEARNING_RECORDS:"learning_records",STUDY_SESSIONS:"study_sessions",PRACTICE_SESSIONS:"practice_sessions",LEARNING_ANALYTICS:"learning_analytics",APP_VERSION:"app_version"},I="1.0.0";class g{constructor(t="default"){var e,n;u(this,"symbol"!=typeof(e="userId")?e+"":e,n),this.userId=t,this.checkVersion()}checkVersion(){localStorage.getItem(c.APP_VERSION)!==I&&localStorage.setItem(c.APP_VERSION,I)}getStorageKey(t){return`${t}_${this.userId}`}setItem(t,e){try{const n=JSON.stringify(e);localStorage.setItem(this.getStorageKey(t),n)}catch(n){throw console.error("存储数据失败:",n),new Error("存储数据失败，请检查存储空间")}}getItem(t){try{const e=localStorage.getItem(this.getStorageKey(t));return e?JSON.parse(e):null}catch(e){return console.error("读取数据失败:",e),null}}removeItem(t){localStorage.removeItem(this.getStorageKey(t))}saveCourse(t){return d(this,null,function*(){const e=yield this.getCourses(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.COURSES,e)})}getCourses(){return d(this,null,function*(){return this.getItem(c.COURSES)||[]})}getCourse(t){return d(this,null,function*(){return(yield this.getCourses()).find(e=>e.id===t)||null})}deleteCourse(t){return d(this,null,function*(){const e=(yield this.getCourses()).filter(e=>e.id!==t);this.setItem(c.COURSES,e),yield this.deleteChaptersByCourseId(t),yield this.deleteQuestionsByCourseId(t),yield this.deleteQuestionBanksByCourseId(t)})}saveChapter(t){return d(this,null,function*(){const e=yield this.getChapters(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.CHAPTERS,e)})}saveChapterInteractiveContent(t,e){return d(this,null,function*(){const n=yield this.getChapters(),s=n.findIndex(e=>e.id===t);if(!(s>=0))throw new Error("章节不存在");n[s]=l(o({},n[s]),{interactiveContent:e,hasInteractiveContent:!0,interactiveContentType:"generated",updatedAt:(new Date).toISOString()}),this.setItem(c.CHAPTERS,n)})}getChapterInteractiveContent(t){return d(this,null,function*(){const e=yield this.getChapter(t);return(null==e?void 0:e.interactiveContent)||null})}updateChapterInteractiveContentStatus(t,e,n){return d(this,null,function*(){const s=yield this.getChapters(),i=s.findIndex(e=>e.id===t);i>=0&&(s[i]=l(o({},s[i]),{hasInteractiveContent:e,interactiveContentType:n,updatedAt:(new Date).toISOString()}),this.setItem(c.CHAPTERS,s))})}getChapters(){return d(this,null,function*(){return this.getItem(c.CHAPTERS)||[]})}getChaptersByCourseId(t){return d(this,null,function*(){return(yield this.getChapters()).filter(e=>e.courseId===t).sort((t,e)=>t.orderIndex-e.orderIndex)})}getChapter(t){return d(this,null,function*(){return(yield this.getChapters()).find(e=>e.id===t)||null})}deleteChapter(t){return d(this,null,function*(){const e=(yield this.getChapters()).filter(e=>e.id!==t);this.setItem(c.CHAPTERS,e)})}deleteChaptersByCourseId(t){return d(this,null,function*(){const e=(yield this.getChapters()).filter(e=>e.courseId!==t);this.setItem(c.CHAPTERS,e)})}saveQuestion(t){return d(this,null,function*(){const e=yield this.getQuestions(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.QUESTIONS,e)})}getQuestions(){return d(this,null,function*(){return this.getItem(c.QUESTIONS)||[]})}getQuestionsByBankId(t){return d(this,null,function*(){return(yield this.getQuestions()).filter(e=>e.bankId===t)})}getQuestionsByCourseId(t){return d(this,null,function*(){return(yield this.getQuestions()).filter(e=>e.courseId===t)})}getQuestionsByChapterId(t){return d(this,null,function*(){return(yield this.getQuestions()).filter(e=>e.chapterId===t)})}getQuestion(t){return d(this,null,function*(){return(yield this.getQuestions()).find(e=>e.id===t)||null})}deleteQuestion(t){return d(this,null,function*(){const e=(yield this.getQuestions()).filter(e=>e.id!==t);this.setItem(c.QUESTIONS,e)})}deleteQuestionsByCourseId(t){return d(this,null,function*(){const e=(yield this.getQuestions()).filter(e=>e.courseId!==t);this.setItem(c.QUESTIONS,e)})}saveQuestionBank(t){return d(this,null,function*(){const e=yield this.getQuestionBanks(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.QUESTION_BANKS,e)})}getQuestionBanks(){return d(this,null,function*(){return this.getItem(c.QUESTION_BANKS)||[]})}getQuestionBanksByCourseId(t){return d(this,null,function*(){return(yield this.getQuestionBanks()).filter(e=>e.courseId===t)})}getQuestionBank(t){return d(this,null,function*(){return(yield this.getQuestionBanks()).find(e=>e.id===t)||null})}deleteQuestionBank(t){return d(this,null,function*(){const e=(yield this.getQuestionBanks()).filter(e=>e.id!==t);this.setItem(c.QUESTION_BANKS,e),yield this.deleteQuestionsByBankId(t)})}deleteQuestionBanksByCourseId(t){return d(this,null,function*(){const e=(yield this.getQuestionBanks()).filter(e=>e.courseId!==t);this.setItem(c.QUESTION_BANKS,e)})}deleteQuestionsByBankId(t){return d(this,null,function*(){const e=(yield this.getQuestions()).filter(e=>e.bankId!==t);this.setItem(c.QUESTIONS,e)})}saveQuestionGroup(t){return d(this,null,function*(){const e=yield this.getQuestionGroups(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.QUESTION_GROUPS,e)})}getQuestionGroups(){return d(this,null,function*(){return this.getItem(c.QUESTION_GROUPS)||[]})}getQuestionGroupsByCourseId(t){return d(this,null,function*(){return(yield this.getQuestionGroups()).filter(e=>e.courseId===t)})}getQuestionGroup(t){return d(this,null,function*(){return(yield this.getQuestionGroups()).find(e=>e.id===t)||null})}deleteQuestionGroup(t){return d(this,null,function*(){const e=(yield this.getQuestionGroups()).filter(e=>e.id!==t);this.setItem(c.QUESTION_GROUPS,e)})}deleteQuestionGroupsByCourseId(t){return d(this,null,function*(){const e=(yield this.getQuestionGroups()).filter(e=>e.courseId!==t);this.setItem(c.QUESTION_GROUPS,e)})}saveLearningRecord(t){return d(this,null,function*(){const e=yield this.getLearningRecords(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.LEARNING_RECORDS,e)})}getLearningRecords(){return d(this,null,function*(){return this.getItem(c.LEARNING_RECORDS)||[]})}getLearningRecordsByUserId(t){return d(this,null,function*(){return(yield this.getLearningRecords()).filter(e=>e.userId===t)})}getLearningRecordsByCourseId(t){return d(this,null,function*(){return(yield this.getLearningRecords()).filter(e=>e.courseId===t)})}saveStudySession(t){return d(this,null,function*(){const e=yield this.getStudySessions(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=l(o({},t),{updatedAt:(new Date).toISOString()}):e.push(l(o({},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})),this.setItem(c.STUDY_SESSIONS,e)})}getStudySessions(){return d(this,null,function*(){return this.getItem(c.STUDY_SESSIONS)||[]})}getStudySessionsByUserId(t){return d(this,null,function*(){return(yield this.getStudySessions()).filter(e=>e.userId===t)})}savePracticeSession(t){return d(this,null,function*(){const e=yield this.getPracticeSessions(),n=e.findIndex(e=>e.id===t.id);n>=0?e[n]=o({},t):e.push(o({},t)),this.setItem(c.PRACTICE_SESSIONS,e)})}getPracticeSessions(){return d(this,null,function*(){return this.getItem(c.PRACTICE_SESSIONS)||[]})}getPracticeSessionsByUserId(t){return d(this,null,function*(){return(yield this.getPracticeSessions()).filter(e=>e.userId===t)})}getPracticeSession(t){return d(this,null,function*(){return(yield this.getPracticeSessions()).find(e=>e.id===t)||null})}deletePracticeSession(t){return d(this,null,function*(){const e=(yield this.getPracticeSessions()).filter(e=>e.id!==t);this.setItem(c.PRACTICE_SESSIONS,e)})}saveLearningAnalytics(t){return d(this,null,function*(){this.setItem(c.LEARNING_ANALYTICS,t)})}getLearningAnalytics(){return d(this,null,function*(){return this.getItem(c.LEARNING_ANALYTICS)})}exportData(){return d(this,null,function*(){const t={courses:yield this.getCourses(),chapters:yield this.getChapters(),questions:yield this.getQuestions(),questionBanks:yield this.getQuestionBanks(),learningRecords:yield this.getLearningRecords(),studySessions:yield this.getStudySessions(),practiceSessions:yield this.getPracticeSessions(),version:I,exportDate:(new Date).toISOString()};return JSON.stringify(t,null,2)})}importData(t){return d(this,null,function*(){try{const e=JSON.parse(t);if(!e.version||!e.exportDate)throw new Error("无效的数据格式");e.courses&&this.setItem(c.COURSES,e.courses),e.chapters&&this.setItem(c.CHAPTERS,e.chapters),e.questions&&this.setItem(c.QUESTIONS,e.questions),e.questionBanks&&this.setItem(c.QUESTION_BANKS,e.questionBanks),e.learningRecords&&this.setItem(c.LEARNING_RECORDS,e.learningRecords),e.studySessions&&this.setItem(c.STUDY_SESSIONS,e.studySessions),e.practiceSessions&&this.setItem(c.PRACTICE_SESSIONS,e.practiceSessions)}catch(e){throw console.error("导入数据失败:",e),new Error("导入数据失败，请检查数据格式")}})}clearAllData(){return d(this,null,function*(){Object.values(c).forEach(t=>{this.removeItem(t)})})}getStorageUsage(){let t=0;Object.values(c).forEach(e=>{const n=localStorage.getItem(this.getStorageKey(e));n&&(t+=n.length)});const e=5242880;return{used:t,available:e-t,total:e}}}let y=null;const f=(t="default")=>(y&&y.userId===t||(y=new g(t)),y);export{a as C,h as Q,S as a,f as c};
