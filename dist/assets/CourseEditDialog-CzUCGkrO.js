var e=(e,l,a)=>new Promise((t,s)=>{var o=e=>{try{r(a.next(e))}catch(l){s(l)}},i=e=>{try{r(a.throw(e))}catch(l){s(l)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,i);r((a=a.apply(e,l)).next())});/* empty css             *//* empty css                   *//* empty css                   *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     */import{c as l,I as a,s as t,z as s,b as o,e as i,d as r,y as d,B as u,P as c,h as n,Q as p,R as v,N as m,M as h,E as g}from"./element-plus-1qB5igSe.js";import{u as b}from"./course-DWSJBfyD.js";import{y as f,r as V,h as j,I as y,J as _,A as w,B as x,R as U,O as k,u as z,K as C,z as q,a5 as I,Q as $,P as B,L as P}from"./vue-vendor-BRizdQXW.js";import{_ as E}from"./_plugin-vue_export-helper-BCo6x5W8.js";const M={class:"dialog-content"},R={class:"dialog-header"},D={class:"dialog-title"},F={class:"dialog-body"},J={class:"form-section"},Q={class:"form-row"},A={class:"form-section"},G={class:"objectives-edit"},K={class:"form-section"},L={class:"chapters-edit"},N={class:"chapter-edit-header"},O={class:"chapter-number"},H={class:"chapter-form-grid"},S={class:"dialog-footer"},T={class:"footer-actions"},W=E(f({__name:"CourseEditDialog",props:{modelValue:{type:Boolean},course:{default:null}},emits:["update:modelValue","saved"],setup(f,{emit:E}){const W=f,X=E,Y=b(),Z=V(),ee=V(!1),le=V(!1),ae=V(!1),te=V({title:"",description:"",level:"intermediate",status:"draft",objectives:[],chapters:[]}),se={title:[{required:!0,message:"请输入课程标题",trigger:"blur"},{min:2,max:100,message:"标题长度在 2 到 100 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入课程描述",trigger:"blur"},{min:10,max:500,message:"描述长度在 10 到 500 个字符",trigger:"blur"}],level:[{required:!0,message:"请选择难度级别",trigger:"change"}],status:[{required:!0,message:"请选择课程状态",trigger:"change"}]};j(()=>W.modelValue,e=>{ae.value=e,e&&W.course&&oe()}),j(ae,e=>{X("update:modelValue",e)});const oe=()=>e(null,null,function*(){var e;if(W.course)try{ee.value=!0;let l=W.course;l.chapters&&0!==l.chapters.length||(l=yield Y.fetchCourse(W.course.id)),te.value={title:l.title,description:l.description,level:l.level,status:l.status,objectives:l.objectives||[],chapters:(null==(e=l.chapters)?void 0:e.map(e=>({order:e.orderIndex,title:e.title,description:e.description,duration:e.durationMinutes,content:e.content})))||[]},0===te.value.objectives.length&&te.value.objectives.push(""),0===te.value.chapters.length&&re()}catch(l){console.error("加载课程数据失败:",l),g.error("加载课程数据失败")}finally{ee.value=!1}}),ie=()=>{te.value.objectives.length<10&&te.value.objectives.push("")},re=()=>{if(te.value.chapters.length<20){const e=te.value.chapters.length+1;te.value.chapters.push({order:e,title:"",description:"",duration:30,content:""})}},de=()=>e(null,null,function*(){if(Z.value&&W.course)try{yield Z.value.validate(),le.value=!0;const e={title:te.value.title,description:te.value.description,level:te.value.level,status:te.value.status,objectives:te.value.objectives.filter(e=>""!==e.trim()),chapters:te.value.chapters.map(e=>({title:e.title,description:e.description,content:e.content,orderIndex:e.order,durationMinutes:e.duration}))},l=yield Y.updateCourse(W.course.id,e);g.success("课程更新成功"),X("saved",l),ue()}catch(e){console.error("保存课程失败:",e),g.error("保存失败，请重试")}finally{le.value=!1}}),ue=()=>{ae.value=!1};return(e,g)=>{const b=t,f=i,V=r,j=u,E=d,W=n,X=v,Y=o,oe=l,ce=s;return w(),y(oe,{modelValue:ae.value,"onUpdate:modelValue":g[4]||(g[4]=e=>ae.value=e),width:"900px",top:"80px","close-on-click-modal":!1,class:"edit-dialog","show-close":!1},{default:_(()=>[x("div",M,[x("div",R,[x("h3",D,[U(b,null,{default:_(()=>[U(z(a))]),_:1}),g[5]||(g[5]=k(" 编辑课程信息 ",-1))]),g[6]||(g[6]=x("p",{class:"dialog-subtitle"},"您可以修改课程内容，让课程更符合您的需求",-1))]),x("div",F,[C((w(),y(Y,{ref_key:"editFormRef",ref:Z,model:te.value,rules:se,"label-width":"100px","label-position":"top",class:"edit-form"},{default:_(()=>[x("div",J,[g[7]||(g[7]=x("h4",{class:"section-title"},"基础信息",-1)),U(V,{label:"课程标题",prop:"title"},{default:_(()=>[U(f,{modelValue:te.value.title,"onUpdate:modelValue":g[0]||(g[0]=e=>te.value.title=e),placeholder:"请输入课程标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),U(V,{label:"课程描述",prop:"description"},{default:_(()=>[U(f,{modelValue:te.value.description,"onUpdate:modelValue":g[1]||(g[1]=e=>te.value.description=e),type:"textarea",rows:4,placeholder:"请输入课程描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),x("div",Q,[U(V,{label:"难度级别",prop:"level",class:"form-col"},{default:_(()=>[U(E,{modelValue:te.value.level,"onUpdate:modelValue":g[2]||(g[2]=e=>te.value.level=e),placeholder:"请选择难度级别",style:{width:"100%"}},{default:_(()=>[U(j,{label:"初级",value:"beginner"}),U(j,{label:"中级",value:"intermediate"}),U(j,{label:"高级",value:"advanced"})]),_:1},8,["modelValue"])]),_:1}),U(V,{label:"课程状态",prop:"status",class:"form-col"},{default:_(()=>[U(E,{modelValue:te.value.status,"onUpdate:modelValue":g[3]||(g[3]=e=>te.value.status=e),placeholder:"请选择课程状态",style:{width:"100%"}},{default:_(()=>[U(j,{label:"草稿",value:"draft"}),U(j,{label:"已发布",value:"published"}),U(j,{label:"已归档",value:"archived"})]),_:1},8,["modelValue"])]),_:1})])]),x("div",A,[g[9]||(g[9]=x("h4",{class:"section-title"},"学习目标",-1)),x("div",G,[(w(!0),q($,null,I(te.value.objectives,(e,l)=>(w(),q("div",{key:l,class:"objective-edit-item"},[U(f,{modelValue:te.value.objectives[l],"onUpdate:modelValue":e=>te.value.objectives[l]=e,placeholder:`学习目标 ${l+1}`,maxlength:"200","show-word-limit":"",size:"large"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),U(W,{type:"danger",icon:z(c),circle:"",size:"large",onClick:e=>(e=>{te.value.objectives.length>1&&te.value.objectives.splice(e,1)})(l),disabled:te.value.objectives.length<=1},null,8,["icon","onClick","disabled"])]))),128)),U(W,{type:"primary",icon:z(p),size:"large",onClick:ie,disabled:te.value.objectives.length>=10,class:"add-objective-btn"},{default:_(()=>[...g[8]||(g[8]=[k(" 添加学习目标 ",-1)])]),_:1},8,["icon","disabled"])])]),x("div",K,[g[11]||(g[11]=x("h4",{class:"section-title"},"课程章节",-1)),x("div",L,[(w(!0),q($,null,I(te.value.chapters,(e,l)=>(w(),q("div",{key:l,class:"chapter-edit-item"},[x("div",N,[x("span",O,"第"+B(e.order)+"章",1),U(W,{type:"danger",icon:z(c),circle:"",size:"large",onClick:e=>(e=>{te.value.chapters.length>1&&(te.value.chapters.splice(e,1),te.value.chapters.forEach((e,l)=>{e.order=l+1}))})(l),disabled:te.value.chapters.length<=1},null,8,["icon","onClick","disabled"])]),x("div",H,[U(V,{label:"章节标题",prop:`chapters.${l}.title`,class:"chapter-title-field"},{default:_(()=>[U(f,{modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,placeholder:"请输入章节标题",maxlength:"100","show-word-limit":"",size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),U(V,{label:"预计时长（分钟）",prop:`chapters.${l}.duration`,class:"chapter-duration-field"},{default:_(()=>[U(X,{modelValue:e.duration,"onUpdate:modelValue":l=>e.duration=l,min:1,max:300,placeholder:"请输入预计时长",size:"large","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),U(V,{label:"章节描述",prop:`chapters.${l}.description`,class:"chapter-description-field"},{default:_(()=>[U(f,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,type:"textarea",rows:3,placeholder:"请输入章节描述",maxlength:"300","show-word-limit":"",size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),U(V,{label:"章节内容",prop:`chapters.${l}.content`,class:"chapter-content-field"},{default:_(()=>[U(f,{modelValue:e.content,"onUpdate:modelValue":l=>e.content=l,type:"textarea",rows:6,placeholder:"请输入章节详细内容",maxlength:"2000","show-word-limit":"",size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]))),128)),U(W,{type:"primary",icon:z(p),size:"large",onClick:re,disabled:te.value.chapters.length>=20,class:"add-chapter-btn"},{default:_(()=>[...g[10]||(g[10]=[k(" 添加章节 ",-1)])]),_:1},8,["icon","disabled"])])])]),_:1},8,["model"])),[[ce,ee.value]])]),x("div",S,[x("div",T,[U(W,{onClick:ue},{default:_(()=>[U(b,null,{default:_(()=>[U(z(m))]),_:1}),g[12]||(g[12]=k(" 取消 ",-1))]),_:1}),U(W,{type:"primary",onClick:de,loading:le.value,class:"save-button"},{default:_(()=>[le.value?P("",!0):(w(),y(b,{key:0},{default:_(()=>[U(z(h))]),_:1})),k(" "+B(le.value?"保存中...":"保存修改"),1)]),_:1},8,["loading"])])])])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-8d5cdace"]]);export{W as C};
