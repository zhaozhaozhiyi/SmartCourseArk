var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,o=(e,o)=>{for(var r in o||(o={}))s.call(o,r)&&l(e,r,o[r]);if(t)for(var r of t(o))n.call(o,r)&&l(e,r,o[r]);return e},r=(e,t,s)=>new Promise((n,l)=>{var o=e=>{try{a(s.next(e))}catch(t){l(t)}},r=e=>{try{a(s.throw(e))}catch(t){l(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,r);a((s=s.apply(e,t)).next())});import{ax as a,r as u,c as i}from"./vue-vendor-BRizdQXW.js";import{c}from"./storage-B26rRKbu.js";import{u as d}from"./index-BKrBH71_.js";const v=a("practice",()=>{const e=u([]),t=u(null),s=u(!1),n=u(null),l=i(()=>e.value.length),a=i(()=>e.value.filter(e=>"completed"===e.status)),v=i(()=>e.value.filter(e=>"in_progress"===e.status));let f=c();const w=d(),g=()=>{var e;const t=(null==(e=w.userInfo)?void 0:e.userId)||"default";f=c(t)},y=(l,a)=>r(null,null,function*(){var r;try{s.value=!0,n.value=null,g();const u=(yield f.getPracticeSessions())||[],i=u.findIndex(e=>e.id===l);if(-1!==i){u[i]=o(o({},u[i]),a);for(const e of u)yield f.savePracticeSession(e);(null==(r=t.value)?void 0:r.id)===l&&(t.value=u[i]);const s=e.value.findIndex(e=>e.id===l);-1!==s&&(e.value[s]=u[i])}}catch(u){throw n.value=u.message||"更新练习会话失败",u}finally{s.value=!1}});return{practiceSessions:e,currentSession:t,loading:s,error:n,sessionCount:l,completedSessions:a,inProgressSessions:v,fetchPracticeSessions:t=>r(null,null,function*(){try{s.value=!0,n.value=null,g();const l=(yield f.getPracticeSessions())||[];let o=l;(null==t?void 0:t.keyword)&&(o=l.filter(e=>e.id.toLowerCase().includes(t.keyword.toLowerCase()))),(null==t?void 0:t.status)&&(o=o.filter(e=>e.status===t.status)),(null==t?void 0:t.courseId)&&(o=o.filter(e=>e.courseId===t.courseId));const r=o.length,a=(((null==t?void 0:t.page)||1)-1)*((null==t?void 0:t.pageSize)||10),u=a+((null==t?void 0:t.pageSize)||10),i=o.slice(a,u);return e.value=i,{sessions:i,total:r,page:(null==t?void 0:t.page)||1,pageSize:(null==t?void 0:t.pageSize)||10}}catch(l){throw n.value=l.message||"获取练习会话失败",l}finally{s.value=!1}}),fetchPracticeSession:e=>r(null,null,function*(){try{s.value=!0,n.value=null,g();const l=((yield f.getPracticeSessions())||[]).find(t=>t.id===e);return l?(t.value=l,l):null}catch(l){throw n.value=l.message||"获取练习会话失败",l}finally{s.value=!1}}),createPracticeSession:l=>r(null,null,function*(){var o;try{s.value=!0,n.value=null,g();const r={id:`session_${Date.now()}`,userId:(null==(o=w.userInfo)?void 0:o.userId)||"default",courseId:l.courseId,questionBankId:l.questionBankId,startTime:(new Date).toISOString(),totalQuestions:l.questionCount||0,answeredQuestions:0,correctQuestions:0,answers:[],status:"in_progress",duration:0,createdAt:(new Date).toISOString(),questionTypes:l.questionTypes},a=(yield f.getPracticeSessions())||[];a.push(r);for(const e of a)yield f.savePracticeSession(e);return t.value=r,e.value.unshift(r),r}catch(r){throw n.value=r.message||"创建练习会话失败",r}finally{s.value=!1}}),updatePracticeSession:y,submitAnswer:(l,o,a)=>r(null,null,function*(){try{s.value=!0,n.value=null;const r=e.value.find(e=>e.id===l)||t.value;if(!r)throw new Error("练习会话不存在");const u=Math.random()>.3,i={questionId:o,userAnswer:a,isCorrect:u},c=r.answers.findIndex(e=>e.questionId===o);-1!==c?r.answers[c]=i:(r.answers.push(i),r.answeredQuestions+=1,u&&(r.correctQuestions+=1)),yield y(l,{answers:r.answers,answeredQuestions:r.answeredQuestions,correctQuestions:r.correctQuestions})}catch(r){throw n.value=r.message||"提交答案失败",r}finally{s.value=!1}}),completePracticeSession:l=>r(null,null,function*(){try{s.value=!0,n.value=null;const o=e.value.find(e=>e.id===l)||t.value;if(!o)throw new Error("练习会话不存在");const r=(new Date).toISOString(),a=Math.floor((new Date(r).getTime()-new Date(o.startTime).getTime())/1e3),u=o.totalQuestions>0?Math.round(o.correctQuestions/o.totalQuestions*100):0,i={sessionId:l,score:u,totalQuestions:o.totalQuestions,correctQuestions:o.correctQuestions,incorrectQuestions:o.totalQuestions-o.correctQuestions,duration:a,answers:o.answers};return yield y(l,{status:"completed",endTime:r,duration:a,score:u}),i}catch(o){throw n.value=o.message||"完成练习会话失败",o}finally{s.value=!1}}),deletePracticeSession:l=>r(null,null,function*(){var o;try{s.value=!0,n.value=null,g(),yield f.deletePracticeSession(l),e.value=e.value.filter(e=>e.id!==l),(null==(o=t.value)?void 0:o.id)===l&&(t.value=null)}catch(r){throw n.value=r.message||"删除练习会话失败",r}finally{s.value=!1}}),getPracticeStats:e=>r(null,null,function*(){try{g();const t=(yield f.getPracticeSessions())||[];let s=t;e&&(s=t.filter(t=>t.courseId===e));const n=s.filter(e=>"completed"===e.status),l=n.reduce((e,t)=>e+t.totalQuestions,0),o=n.reduce((e,t)=>e+t.correctQuestions,0),r=n.length>0?Math.round(n.reduce((e,t)=>e+(t.score||0),0)/n.length):0,a=n.reduce((e,t)=>e+t.duration,0);return{totalSessions:s.length,completedSessions:n.length,totalQuestions:l,correctQuestions:o,averageScore:r,totalDuration:a}}catch(t){throw n.value=t.message||"获取练习统计失败",t}})}});export{v as u};
