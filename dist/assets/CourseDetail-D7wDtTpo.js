var e=(e,s,a)=>new Promise((l,t)=>{var i=e=>{try{c(a.next(e))}catch(s){t(s)}},r=e=>{try{c(a.throw(e))}catch(s){t(s)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,r);c((a=a.apply(e,s)).next())});/* empty css             *//* empty css                   *//* empty css                    *//* empty css                  *//* empty css                         *//* empty css                  *//* empty css               */import{y as s,r as a,c as l,j as t,aC as i,K as r,z as c,B as n,L as u,R as o,J as d,P as v,u as p,Q as m,a5 as f,A as h,O as y,aB as g}from"./vue-vendor-BRizdQXW.js";import{l as k,v as C,D as j,c as w,B as _,e as b,L as x,E as D,u as $,b as z,k as B,G as S,j as q,a as I,f as L,F as T}from"./index-CgjG02ur.js";import{u as A}from"./course-DWSJBfyD.js";import{C as E}from"./CourseEditDialog-CzUCGkrO.js";import{E as F,z as O,C as P,h as V,q as G,D as J,v as M,w as H,F as K}from"./element-plus-1qB5igSe.js";import{_ as N}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./storage-B26rRKbu.js";import"./index-B0rpCtHA.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                     */const Q={class:"course-detail"},R={class:"course-header"},U={class:"course-info"},W={class:"course-meta"},X={class:"course-title"},Y={class:"course-description"},Z={class:"course-stats"},ee={class:"stat-item"},se={class:"stat-item"},ae={key:0,class:"stat-item"},le={class:"course-actions"},te={class:"chapters-section"},ie={class:"section-header"},re={class:"section-actions"},ce={class:"chapters-list"},ne={key:0,class:"empty-chapters"},ue={class:"empty-icon"},oe={class:"chapter-content"},de={class:"chapter-order"},ve={class:"chapter-info"},pe={class:"chapter-title"},me={class:"chapter-description"},fe={class:"chapter-meta"},he={class:"duration"},ye={key:0,class:"completed"},ge={class:"chapter-actions"},ke={key:0,class:"progress-section"},Ce={class:"progress-content"},je={class:"progress-bar"},we={class:"progress-stats"},_e={class:"stat-item"},be={class:"value"},xe={class:"stat-item"},De={class:"value"},$e={class:"stat-item"},ze={class:"value"},Be={class:"recent-activity"},Se={class:"activity-list"},qe={key:0,class:"empty-activity"},Ie={class:"activity-icon"},Le={class:"activity-content"},Te={class:"activity-title"},Ae={class:"activity-time"},Ee=N(s({__name:"CourseDetail",setup(s){k.add(C,j,w,_,b,x,D,$,z,B,S,q,I,L);const N=i(),Ee=g(),Fe=A(),Oe=a(!1),Pe=a(null),Ve=a([]),Ge=a(!1),Je=l(()=>{var e,s;return(null==(s=null==(e=Pe.value)?void 0:e.chapters)?void 0:s.filter(e=>e.isCompleted).length)||0}),Me=l(()=>{var e,s;return(null==(s=null==(e=Pe.value)?void 0:e.chapters)?void 0:s.reduce((e,s)=>e+(s.learnedDuration||0),0))||0});t(()=>{const e=N.params.id;e&&(He(e),Ke())});const He=s=>e(null,null,function*(){try{Oe.value=!0;const e=yield Fe.fetchCourse(s);Pe.value=e}catch(e){console.error("获取课程详情失败:",e),F.error("获取课程详情失败")}finally{Oe.value=!1}}),Ke=s=>e(null,null,function*(){Ve.value=[{id:"1",type:"study",title:"完成了第一章的学习",time:(new Date).toISOString()},{id:"2",type:"practice",title:"完成了章节练习",time:new Date(Date.now()-864e5).toISOString()}]}),Ne=()=>{var e;(null==(e=Pe.value)?void 0:e.id)&&Ee.push(`/courses/${Pe.value.id}/learn`)},Qe=()=>{Ge.value=!0},Re=e=>{Pe.value=e,Ge.value=!1},Ue=()=>{var e;(null==(e=Pe.value)?void 0:e.id)&&Ee.push(`/questions/generate/${Pe.value.id}`)},We=()=>{var e;(null==(e=Pe.value)?void 0:e.id)&&Ee.push(`/analytics/${Pe.value.id}`)},Xe=()=>{var e;(null==(e=Pe.value)?void 0:e.id)&&Ee.push(`/courses/${Pe.value.id}/edit?action=add-chapter`)},Ye=()=>e(null,null,function*(){if(Pe.value)try{yield K.confirm(`确定要删除课程"${Pe.value.title}"吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),yield Fe.deleteCourse(Pe.value.id),F.success("课程删除成功"),Ee.push("/courses")}catch(e){"cancel"!==e&&(console.error("删除课程失败:",e),F.error("删除课程失败"))}}),Ze=()=>{F.info("导出功能开发中...")},es=e=>{switch(e){case"published":return"success";case"draft":return"warning";default:return"info"}},ss=e=>{switch(e){case"published":return"已发布";case"draft":return"草稿";case"archived":return"已归档";default:return"未知"}},as=e=>{switch(e){case"beginner":return"success";case"intermediate":return"warning";case"advanced":return"danger";default:return"info"}},ls=e=>{switch(e){case"beginner":return"初级";case"intermediate":return"中级";case"advanced":return"高级";default:return"未知"}},ts=e=>{switch(e){case"study":return["fas","graduation-cap"];case"practice":return["fas","question-circle"];default:return["fas","clock"]}},is=e=>{if(!e)return"暂无";return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},rs=e=>{if(!e)return"0分钟";if(e<60)return`${e}分钟`;const s=Math.floor(e/60),a=e%60;return a>0?`${s}小时${a}分钟`:`${s}小时`};return(s,a)=>{var l,t,i,g,k,C,j,w,_,b,x,D,$;const z=P,B=V,S=H,q=M,I=G,L=J,A=O;return r((h(),c("div",Q,[n("div",R,[n("div",U,[n("div",W,[o(z,{type:es(null==(l=Pe.value)?void 0:l.status),class:"mr-2"},{default:d(()=>{var e;return[y(v(ss(null==(e=Pe.value)?void 0:e.status)),1)]}),_:1},8,["type"]),o(z,{type:as(null==(t=Pe.value)?void 0:t.level),size:"small"},{default:d(()=>{var e;return[y(v(ls(null==(e=Pe.value)?void 0:e.level)),1)]}),_:1},8,["type"])]),n("h1",X,v(null==(i=Pe.value)?void 0:i.title),1),n("p",Y,v(null==(g=Pe.value)?void 0:g.description),1),n("div",Z,[n("div",ee,[o(p(T),{icon:["fas","list"]}),n("span",null,v((null==(C=null==(k=Pe.value)?void 0:k.chapters)?void 0:C.length)||0)+" 章节",1)]),n("div",se,[o(p(T),{icon:["fas","clock"]}),n("span",null,v(rs(null==(j=Pe.value)?void 0:j.totalDuration)),1)]),void 0!==(null==(w=Pe.value)?void 0:w.progress)?(h(),c("div",ae,[o(p(T),{icon:["fas","chart-line"]}),n("span",null,v(Pe.value.progress)+"% 完成",1)])):u("",!0)])]),n("div",le,[o(B,{type:"primary",onClick:Ne},{default:d(()=>[o(p(T),{icon:["fas","play"],class:"mr-2"}),a[1]||(a[1]=y(" 开始学习 ",-1))]),_:1}),o(B,{onClick:Qe},{default:d(()=>[o(p(T),{icon:["fas","edit"],class:"mr-2"}),a[2]||(a[2]=y(" 编辑课程 ",-1))]),_:1}),o(B,{onClick:Ue},{default:d(()=>[o(p(T),{icon:["fas","question-circle"],class:"mr-2"}),a[3]||(a[3]=y(" 题库管理 ",-1))]),_:1}),o(I,{trigger:"click"},{dropdown:d(()=>[o(q,null,{default:d(()=>[o(S,{onClick:We},{default:d(()=>[o(p(T),{icon:["fas","chart-bar"],class:"mr-2"}),a[4]||(a[4]=y(" 学习分析 ",-1))]),_:1}),o(S,{onClick:Ze},{default:d(()=>[o(p(T),{icon:["fas","download"],class:"mr-2"}),a[5]||(a[5]=y(" 导出课程 ",-1))]),_:1}),o(S,{onClick:Ye,divided:""},{default:d(()=>[o(p(T),{icon:["fas","trash"],class:"mr-2"}),a[6]||(a[6]=y(" 删除课程 ",-1))]),_:1})]),_:1})]),default:d(()=>[o(B,{type:"text"},{default:d(()=>[o(p(T),{icon:["fas","ellipsis-v"]})]),_:1})]),_:1})])]),n("div",te,[n("div",ie,[a[8]||(a[8]=n("h2",null,"课程章节",-1)),n("div",re,[o(B,{type:"primary",size:"small",onClick:Xe},{default:d(()=>[o(p(T),{icon:["fas","plus"],class:"mr-2"}),a[7]||(a[7]=y(" 添加章节 ",-1))]),_:1})])]),n("div",ce,[0===(null==(b=null==(_=Pe.value)?void 0:_.chapters)?void 0:b.length)?(h(),c("div",ne,[n("div",ue,[o(p(T),{icon:["fas","book-open"]})]),a[10]||(a[10]=n("h3",null,"暂无章节",-1)),a[11]||(a[11]=n("p",null,"添加第一个章节开始构建您的课程",-1)),o(B,{type:"primary",onClick:Xe},{default:d(()=>[o(p(T),{icon:["fas","plus"],class:"mr-2"}),a[9]||(a[9]=y(" 添加章节 ",-1))]),_:1})])):u("",!0),(h(!0),c(m,null,f(null==(x=Pe.value)?void 0:x.chapters,(s,l)=>(h(),c("div",{key:s.id,class:"chapter-item"},[n("div",oe,[n("div",de,v(l+1),1),n("div",ve,[n("h4",pe,v(s.title),1),n("p",me,v(s.description),1),n("div",fe,[n("span",he,v(s.durationMinutes)+"分钟",1),s.isCompleted?(h(),c("span",ye,[o(p(T),{icon:["fas","check-circle"]}),a[12]||(a[12]=y(" 已完成 ",-1))])):u("",!0)])])]),n("div",ge,[o(B,{type:"text",size:"small",onClick:e=>(e=>{var s;(null==(s=Pe.value)?void 0:s.id)&&Ee.push(`/courses/${Pe.value.id}/edit?chapter=${e}`)})(s.id)},{default:d(()=>[o(p(T),{icon:["fas","edit"]})]),_:1},8,["onClick"]),o(B,{type:"text",size:"small",onClick:a=>{return l=s.id,e(null,null,function*(){try{yield K.confirm("确定要删除这个章节吗？此操作不可撤销。","删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),yield Fe.deleteChapter(l),F.success("章节删除成功"),yield He(Pe.value.id)}catch(e){"cancel"!==e&&(console.error("删除章节失败:",e),F.error("删除章节失败"))}});var l}},{default:d(()=>[o(p(T),{icon:["fas","trash"]})]),_:1},8,["onClick"])])]))),128))])]),void 0!==(null==(D=Pe.value)?void 0:D.progress)?(h(),c("div",ke,[a[16]||(a[16]=n("div",{class:"section-header"},[n("h2",null,"学习进度")],-1)),n("div",Ce,[n("div",je,[o(L,{percentage:Pe.value.progress,"stroke-width":8,"show-text":!0},null,8,["percentage"])]),n("div",we,[n("div",_e,[a[13]||(a[13]=n("span",{class:"label"},"已完成章节",-1)),n("span",be,v(Je.value)+"/"+v((null==($=Pe.value.chapters)?void 0:$.length)||0),1)]),n("div",xe,[a[14]||(a[14]=n("span",{class:"label"},"学习时长",-1)),n("span",De,v(rs(Me.value)),1)]),n("div",$e,[a[15]||(a[15]=n("span",{class:"label"},"最后学习",-1)),n("span",ze,v(is(Pe.value.lastLearnedAt)),1)])])])])):u("",!0),n("div",Be,[a[18]||(a[18]=n("div",{class:"section-header"},[n("h2",null,"最近活动")],-1)),n("div",Se,[0===Ve.value.length?(h(),c("div",qe,[...a[17]||(a[17]=[n("p",null,"暂无学习记录",-1)])])):u("",!0),(h(!0),c(m,null,f(Ve.value,e=>(h(),c("div",{key:e.id,class:"activity-item"},[n("div",Ie,[o(p(T),{icon:ts(e.type)},null,8,["icon"])]),n("div",Le,[n("div",Te,v(e.title),1),n("div",Ae,v(is(e.time)),1)])]))),128))])]),o(E,{modelValue:Ge.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Ge.value=e),course:Pe.value,onSaved:Re},null,8,["modelValue","course"])])),[[A,Oe.value]])}}}),[["__scopeId","data-v-6b0485de"]]);export{Ee as default};
